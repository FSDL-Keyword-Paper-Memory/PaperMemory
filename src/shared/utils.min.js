var STATE={menuIsOpen:!1,memoryIsOpen:!1,papers:{},papersList:[],sortedPapers:[],sortKey:"",paperTags:new Set,dataVersion:0,pdfTitleFn:null};const select2Options={placeholder:"Tag paper...",maximumSelectionLength:5,allowClear:!0,tags:!0,tokenSeparators:[","," "]},menuCheckNames=["checkBib","checkMd","checkDownload","checkPdfTitle","checkVanity"],menuStorageKeys=[...menuCheckNames,"pdfTitleFn"],knownPaperPages={arxiv:["arxiv.org/pdf/","arxiv.org/abs/"],neurips:["neurips.cc/paper/"],cvf:["openaccess.thecvf.com/content"]},englishStopWords=new Set([["i","me","my","myself","we","our","ours","ourselves","you","your","yours","yourself","yourselves","he","him","his","himself","she","her","hers","herself","it","its","itself","they","them","their","theirs","themselves","what","which","who","whom","this","that","these","those","am","is","are","was","were","be","been","being","have","has","had","having","do","does","did","doing","a","an","the","and","but","if","or","because","as","until","while","of","at","by","for","with","about","against","between","into","through","during","before","after","above","below","to","from","up","down","in","out","on","off","over","under","again","further","then","once","here","there","when","where","why","how","all","any","both","each","few","more","most","other","some","such","no","nor","not","only","own","same","so","than","too","very","s","t","can","will","just","don","should","now"]]);$.easing.jswing=$.easing.swing,$.extend($.easing,{def:"easeOutQuad",swing:(e,t,r,a,n)=>$.easing[$.easing.def](e,t,r,a,n),easeInQuad:(e,t,r,a,n)=>a*(t/=n)*t+r,easeOutQuad:(e,t,r,a,n)=>-a*(t/=n)*(t-2)+r,easeInOutQuad:(e,t,r,a,n)=>(t/=n/2)<1?a/2*t*t+r:-a/2*(--t*(t-2)-1)+r,easeInCubic:(e,t,r,a,n)=>a*(t/=n)*t*t+r,easeOutCubic:(e,t,r,a,n)=>a*((t=t/n-1)*t*t+1)+r,easeInOutCubic:(e,t,r,a,n)=>(t/=n/2)<1?a/2*t*t*t+r:a/2*((t-=2)*t*t+2)+r,easeInQuart:(e,t,r,a,n)=>a*(t/=n)*t*t*t+r,easeOutQuart:(e,t,r,a,n)=>-a*((t=t/n-1)*t*t*t-1)+r,easeInOutQuart:(e,t,r,a,n)=>(t/=n/2)<1?a/2*t*t*t*t+r:-a/2*((t-=2)*t*t*t-2)+r,easeInQuint:(e,t,r,a,n)=>a*(t/=n)*t*t*t*t+r,easeOutQuint:(e,t,r,a,n)=>a*((t=t/n-1)*t*t*t*t+1)+r,easeInOutQuint:(e,t,r,a,n)=>(t/=n/2)<1?a/2*t*t*t*t*t+r:a/2*((t-=2)*t*t*t*t+2)+r,easeInSine:(e,t,r,a,n)=>-a*Math.cos(t/n*(Math.PI/2))+a+r,easeOutSine:(e,t,r,a,n)=>a*Math.sin(t/n*(Math.PI/2))+r,easeInOutSine:(e,t,r,a,n)=>-a/2*(Math.cos(Math.PI*t/n)-1)+r,easeInExpo:(e,t,r,a,n)=>0==t?r:a*Math.pow(2,10*(t/n-1))+r,easeOutExpo:(e,t,r,a,n)=>t==n?r+a:a*(1-Math.pow(2,-10*t/n))+r,easeInOutExpo:(e,t,r,a,n)=>0==t?r:t==n?r+a:(t/=n/2)<1?a/2*Math.pow(2,10*(t-1))+r:a/2*(2-Math.pow(2,-10*--t))+r,easeInCirc:(e,t,r,a,n)=>-a*(Math.sqrt(1-(t/=n)*t)-1)+r,easeOutCirc:(e,t,r,a,n)=>a*Math.sqrt(1-(t=t/n-1)*t)+r,easeInOutCirc:(e,t,r,a,n)=>(t/=n/2)<1?-a/2*(Math.sqrt(1-t*t)-1)+r:a/2*(Math.sqrt(1-(t-=2)*t)+1)+r,easeInElastic:(e,t,r,a,n)=>{var s=1.70158,o=0,i=a;if(0==t)return r;if(1==(t/=n))return r+a;if(o||(o=.3*n),i<Math.abs(a)){i=a;s=o/4}else s=o/(2*Math.PI)*Math.asin(a/i);return-i*Math.pow(2,10*(t-=1))*Math.sin((t*n-s)*(2*Math.PI)/o)+r},easeOutElastic:(e,t,r,a,n)=>{var s=1.70158,o=0,i=a;if(0==t)return r;if(1==(t/=n))return r+a;if(o||(o=.3*n),i<Math.abs(a)){i=a;s=o/4}else s=o/(2*Math.PI)*Math.asin(a/i);return i*Math.pow(2,-10*t)*Math.sin((t*n-s)*(2*Math.PI)/o)+a+r},easeInOutElastic:(e,t,r,a,n)=>{var s=1.70158,o=0,i=a;if(0==t)return r;if(2==(t/=n/2))return r+a;if(o||(o=n*(.3*1.5)),i<Math.abs(a)){i=a;s=o/4}else s=o/(2*Math.PI)*Math.asin(a/i);return t<1?i*Math.pow(2,10*(t-=1))*Math.sin((t*n-s)*(2*Math.PI)/o)*-.5+r:i*Math.pow(2,-10*(t-=1))*Math.sin((t*n-s)*(2*Math.PI)/o)*.5+a+r},easeInBack:(e,t,r,a,n,s)=>(null==s&&(s=1.70158),a*(t/=n)*t*((s+1)*t-s)+r),easeOutBack:(e,t,r,a,n,s)=>(null==s&&(s=1.70158),a*((t=t/n-1)*t*((s+1)*t+s)+1)+r),easeInOutBack:(e,t,r,a,n,s)=>(null==s&&(s=1.70158),(t/=n/2)<1?a/2*(t*t*((1+(s*=1.525))*t-s))+r:a/2*((t-=2)*t*((1+(s*=1.525))*t+s)+2)+r),easeInBounce:(e,t,r,a,n)=>a-$.easing.easeOutBounce(e,n-t,0,a,n)+r,easeOutBounce:(e,t,r,a,n)=>(t/=n)<1/2.75?a*(7.5625*t*t)+r:t<2/2.75?a*(7.5625*(t-=1.5/2.75)*t+.75)+r:t<2.5/2.75?a*(7.5625*(t-=2.25/2.75)*t+.9375)+r:a*(7.5625*(t-=2.625/2.75)*t+.984375)+r,easeInOutBounce:(e,t,r,a,n)=>t<n/2?.5*$.easing.easeInBounce(e,2*t,0,a,n)+r:.5*$.easing.easeOutBounce(e,2*t-n,0,a,n)+.5*a+r});const defaultPDFTitleFn=(e,t)=>(e=e.replaceAll("\n"," ").replace(/\s\s+/g," "),`${e} - ${t}.pdf`),delay=(e,t)=>{let r=0;return(...a)=>{clearTimeout(r),r=setTimeout(e.bind(this,...a),t||0)}},cleanPapers=e=>{let t={...e};return delete t.__dataVersion,t},fallbackCopyTextToClipboard=e=>{var t=document.createElement("textarea");t.value=e,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{var r=document.execCommand("copy"),a=r?"successful":"unsuccessful";console.log("Fallback: Copying text command was "+a)}catch(e){console.error("Fallback: Oops, unable to copy",e)}document.body.removeChild(t)},copyTextToClipboard=e=>{navigator.clipboard?navigator.clipboard.writeText(e).then(()=>{console.log("Async: Copying to clipboard was successful!")},e=>{console.error("Async: Could not copy text: ",e)}):fallbackCopyTextToClipboard(e)},parseUrl=e=>{var t=document.createElement("a");return t.href=e,t},downloadTextFile=(e,t,r)=>{var a=document.createElement("a"),n=new Blob([e],{type:r});a.href=URL.createObjectURL(n),a.download=t,a.trigger("click")},eventId=e=>{const t=$(e.target),r=t.closest(".memory-item-container").attr("id").split("--")[1],a=r.replace(".","\\.");return{id:r,eid:a}},download_file=(e,t)=>{if(window.ActiveXObject){if(window.ActiveXObject&&document.execCommand){var r=window.open(e,"_blank");r.document.close(),r.document.execCommand("SaveAs",!0,t||e),r.close()}}else{var a=document.createElement("a");a.href=e,a.target="_blank";var n=e.substring(e.lastIndexOf("/")+1);if(a.download=t||n,navigator.userAgent.toLowerCase().match(/(ipad|iphone|safari)/)&&navigator.userAgent.search("Chrome")<0)document.location=a.href;else{var s=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});a.dispatchEvent(s),(window.URL||window.webkitURL).revokeObjectURL(a.href)}}},getPdfFn=code=>{try{pdfTitleFn=eval(code)}catch(e){console.log("Error parsing pdf title function. Function string then error:"),console.log(code),console.log(e),pdfTitleFn=defaultPDFTitleFn}try{pdfTitleFn("test","1.2")}catch(e){console.log("Error testing the user's pdf title function. Function string then error:"),console.log(code),console.log(e),pdfTitleFn=defaultPDFTitleFn}return pdfTitleFn},migrateData=async(e,t)=>{if(void 0===e)return{};const r=e.__dataVersion||1;var a=[];try{if(e.hasOwnProperty("__dataVersion")&&e.__dataVersion===t)return e;backupData({...e}),delete e.__dataVersion;for(const t in e)if(r<5&&(e[t].hasOwnProperty("bibtext")||(e[t].bibtext="",console.log("Migrating bibtext for "+t)),e[t].pdfLink.endsWith(".pdf")||(e[t].pdfLink=e[t].pdfLink+".pdf"),e[t].codeLink||(e[t].codeLink=""),e[t].source||(e[t].id.includes("NeurIPS")?e[t].source="neurips":e[t].source="arxiv")),r<208&&("arxiv"!==e[t].source&&e[t].md.includes("https://arxiv.com/abs/")&&(e[t].md=`[${e[t].title}](${e[t].pdfLink})`),"arxiv"!==e[t].source&&e[t].pdfLink.includes("arxiv.org/pdf/")&&(e[t].source="arxiv"),t.match(/^\d/)&&"arxiv"===e[t].source)){const r=`Arxiv-${t}`;let n={...e[t],id:r};e[r]=n,a.push(t)}a.forEach((t,r)=>{delete e[t],console.log("Deleting "+t)});let n={...e};return n.__dataVersion=t,chrome.storage.local.set({papers:n},()=>{console.log("Migrated papers:"),console.log(n),console.log("Data version is now "+t)}),n}catch(a){return console.log(`Error migrating data from version ${r} to ${t}: `),console.log(a),e}},logStorage=e=>{chrome.storage.local.get(e,t=>{console.log(t[e])})},getStorage=async e=>new Promise((t,r)=>{chrome.storage.local.get(e,r=>{t(r[e])})}),setStorage=async(e,t)=>new Promise((r,a)=>{chrome.storage.local.set({[e]:t},()=>{r(!0)})}),backupData=async e=>{chrome.storage.local.get("papersBackup",({papersBackup:t})=>{void 0===t&&(t={});const r=Object.keys(t).map(e=>parseInt(e)).sort((e,t)=>e<t?1:-1).slice(4);for(const e of r)delete t[e];t[e.__dataVersion]=e,chrome.storage.local.set({papersBackup:t},()=>{console.log("Backed up data with version: "+e.__dataVersion)})})},statePdfTitle=(e,t)=>{let r;try{r=STATE.pdfTitleFn(e,t)}catch(a){r=defaultPDFTitleFn(e,t)}return r.replaceAll("\n"," ").replace(/\s\s+/g," ")},manifestDataVersion=()=>{const e=chrome.runtime.getManifest();return e.version.split(".").map((e,t)=>parseInt(e)*10**(4-2*t)).reduce((e,t)=>e+t)},initState=async(e,t)=>{if(console.log("Found papers:"),console.log(e),STATE.dataVersion=manifestDataVersion(),STATE.pdfTitleFn=defaultPDFTitleFn,e=await migrateData(e,STATE.dataVersion),t)return e;STATE.papers=e,STATE.papersList=Object.values(cleanPapers(e)),STATE.sortKey="lastOpenDate",sortMemory(),makeTags()},hashCode=e=>e.split("").reduce((e,t)=>(e=(e<<5)-e+t.charCodeAt(0),e&e),0),parseCVFUrl=e=>{const t=e.replace("https://openaccess.thecvf.com/content","").slice(1).split("/")[0].split("_");let r,a;1===t.length?(r=t[0].slice(0,-4),a=t[0].slice(-4)):(r=t[0].toUpperCase(),a=t[1]);const n=e.split("/").reverse()[0].split(".")[0],s=(hashCode(n)+"").replace("-","").slice(0,8),o=`${r}-${a}_${s}`;return{conf:r,year:a,id:o}},isPaper=e=>{parseUrl(e);let t={};for(const r in knownPaperPages){const a=knownPaperPages[r];t[r]=!1;for(const n of a)e.includes(n)&&(t[r]=!0)}return t},parseIdFromUrl=e=>{const t=isPaper(e);if(t.arxiv){const t=e.split("/").reverse()[0].replace(".pdf","").split("v")[0];return`Arxiv-${t}`}if(t.neurips){const t=e.split("/paper/")[1].split("/")[0],r=e.split("/").reverse()[0].split("-")[0].slice(0,8);return`NeurIPS-${t}_${r}`}if(t.cvf)return parseCVFUrl(e).id;throw Error("unknown paper url")},handlePopupKeydown=e=>{if([8,13,27,65,69].indexOf(e.which)<0)return;if(STATE.menuIsOpen)return void(27===e.which&&(e.preventDefault(),closeMenu()));if(!STATE.memoryIsOpen){if(65==e.which){if($(":focus").length)return;$("#memory-switch").trigger("click")}else if(13==e.which){let e=$("#memory-switch-text-on:focus").first();if(e.length>0)return void $("#memory-switch").trigger("click");if(e=$("#tabler-menu:focus").first(),e.length>0)return $("#tabler-menu").trigger("click"),void $("#tabler-menu").blur()}return}let t,r;const a=$(".memory-item-container:focus").first();if(27!==e.which){if(1!==a.length)return;t=a.attr("id").split("--")[1],r=t.replace(".","\\.")}8===e.which?findEl(r,"delete-memory-item").trigger("click"):13===e.which?findEl(r,"memory-item-link").trigger("click"):27===e.which?(e.preventDefault(),closeMemory()):69===e.which&&findEl(r,"memory-item-edit").trigger("click")},focusEndTextarea=e=>{setTimeout(()=>{e.selectionStart=e.selectionEnd=1e4},0)},formatBibtext=e=>{let t=$.trim(e).split("\n").join("");const r=t.match(/\w+\ ?=/g);if(r)for(const e of r)t=t.replace(e,`\n  ${e}`);return"}}"===t.slice(-2)&&(t=t.slice(0,-1)+"\n}"),t};String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};const firstNonStopLowercase=e=>{let t=e.toLowerCase(),r=t.split(" ").map(e=>e.replace(/[^0-9a-z]/gi,"")),a=r.filter(e=>englishStopWords.has(e));return a.length>0?a[0]:r[0]},parseArxivBibtex=e=>{var t=$(e),r=[],a="";t.find("author name").each((e,t)=>{r.push($(t).text()),0===e&&(a+=$(t).text().split(" ")[$(t).text().split(" ").length-1].toLowerCase())});var n="";t.find("link").each((e,t)=>{const r=$(t).attr("href");r&&r.indexOf("arxiv.org/pdf/")>=0&&(n=r)});const s=r.join(" and "),o=$(t.find("entry title")[0]).text(),i=$(t.find("entry published")[0]).text().slice(0,4);let c;a+=i,a+=firstNonStopLowercase(o);const l=t.find("id");l.each((e,t)=>{$(t).html().match(/\d\d\d\d\.\d\d\d\d\d/g)&&(c=$(t).html().match(/\d\d\d\d\.\d\d\d\d\d/g)[0])}),c=`Arxiv-${c}`;const p={key:a,title:o,author:s,year:i,id:c,pdfLink:n};let d="";return d+=`@article{${a}, \n`,d+=`    title = { ${o} }, \n`,d+=`    author = { ${s} }, \n`,d+=`    year = { ${i}}, \n`,d+=`    journal = { arXiv preprint arXiv: ${c}}\n`,d+="}",{bibvars:p,bibtext:d}},parseNeuripsHTML=(e,t)=>{const r=(new DOMParser).parseFromString(t.replaceAll("\n",""),"text/html"),a=$(r),n=a.find(".container-fluid .col p"),s=e.split("/").slice(-1)[0].replace("-Paper.pdf",""),o=a.find("h4").first().text(),i=$(n[1]).text().split(", ").map((e,t)=>{const r=e.split(" "),a=r.map((e,t)=>e.capitalize());return a.join(" ")}).join(" and "),c=e,l=$(n[0]).text().match(/\d{4}/)[0],p=`neurips${l}${s.slice(0,8)} `,d=`NeurIPS - ${l}_${s.slice(0,8)} `,h=`\n@inproceedings{NEURIPS${l}_${s.slice(0,8)}\n    author = { ${i}\n},\nbooktitle = { Advances in Neural Information Processing Systems },\n    editor = { H.Larochelle and M.Ranzato and R.Hadsell and M.F.Balcan and H.Lin },\n    publisher = { Curran Associates, Inc.},\n    title = { ${o}},\nurl = { ${e}},\nyear = { ${l}}\n}`;return{key:p,title:o,author:i,year:l,id:d,pdfLink:c,bibtext:h}},parseCvfHTML=(e,t)=>{const r=(new DOMParser).parseFromString(t.replaceAll("\n",""),"text/html"),a=$(r),n=$.trim(a.find("#papertitle").text());let s=a.find("#authors i").first().text();s=s.split(",").map(e=>$.trim(e)).join(" and ");const{year:o,id:i,conf:c}=parseCVFUrl(e);let l="";e.endsWith(".pdf")?l=e:a.find("a").each((e,t)=>{if("pdf"===$(t).text()){let e=$(t).attr("href");e.startsWith("../")&&(e=e.replaceAll("../","")),e.startsWith("/")||(e="/"+e),l="http://openaccess.thecvf.com"+e}});const p=a.find(".bibref").first().text().replaceAll(",  ",",\n  "),d=p.split("{")[1].split(",")[0];return{key:d,title:n,author:s,year:o,id:i,pdfLink:l,bibtext:p,conf:c}},fetchArxivBibtex=async e=>$.get(`https://export.arxiv.org/api/query?id_list=${e}`),fetchNeuripsHTML=async e=>{let t;return t=e.endsWith(".pdf")?e.replace("/file/","/hash/").replace("-Paper.pdf","-Abstract.html"):e,fetch(t).then(e=>e.text())},fetchCvfHTML=async e=>{let t,r;if(t=e.endsWith(".pdf")?e.replace("/papers/","/html/").replace(".pdf",".html"):e,r=await fetch(t).then(e=>e.ok?e.text():""),!r&&t.includes("thecvf.com/content_")){const{conf:a,year:n}=parseCVFUrl(e);t=t.replace(`/content_${a}_${n}/`,`/content_${a.toLowerCase()}_${n}/`),r=await fetch(t).then(e=>e.ok?e.text():"")}return r},fetchOpts={headers:{mode:"no-cors"}},fetchPWCId=async(e,t)=>{let r="https://paperswithcode.com/api/v1/papers/?";e?r+=new URLSearchParams({arxiv_id:e}):t&&(r+=new URLSearchParams({title:t}));const a=await $.getJSON(r);if(console.log({json:a}),1===a.count)return a.results[0].id},fetchCodes=async e=>{let t,r;(e.source="neurips")?r=e.title:t=e.id;const a=await fetchPWCId(t,r);if(!a)return[];let n=`https://paperswithcode.com/api/v1/papers/${a}/repositories/?`;n+=new URLSearchParams({page:1,items_per_page:10});const s=await fetch(n),o=await s.json();if(o.count<1)return;let i=o.results;return i.sort((e,t)=>e.stars-t.stars),i.slice(0,5)};