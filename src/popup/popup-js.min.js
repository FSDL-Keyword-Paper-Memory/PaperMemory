const addEventToClass=(e,t,o)=>{document.querySelectorAll(e).forEach(e=>{e.addEventListener(t,o)})},handleBackToFocus=e=>{const t=eventId(e);setTimeout(()=>{document.getElementById(`memory-item-container--${t}`).dispatchEvent(new Event("focus"))},250)},handleDeleteItem=e=>{const t=eventId(e);confirmDelete(t)},handleOpenItemLink=e=>{const t=eventId(e);focusExistingOrCreateNewPaperTab(_state.papers[t])},handleOpenItemCodeLink=e=>{const t=eventId(e),o=_state.papers[t].codeLink;focusExistingOrCreateNewCodeTab(o)},handleCopyMarkdownLink=e=>{const t=eventId(e),o=_state.papers[t].md;copyAndConfirmMemoryItem(t,o,"Markdown link copied!")},handleCopyBibtex=e=>{const t=eventId(e),o=_state.papers[t].bibtext;copyAndConfirmMemoryItem(t,o,"Bibtex copied!")},handleCopyPDFLink=e=>{const t=eventId(e),o=_state.papers[t].pdfLink;copyAndConfirmMemoryItem(t,o,"Pdf link copied!")},handleAddItemToFavorites=e=>{const t=eventId(e),o=hasClass(`memory-item-container--${t}`,"favorite");saveFavoriteItem(t,!o)},handleTextareaFocus=()=>{var e=this;textareaFocusEnd(e)},handleEditPaperFormSubmit=e=>{e.preventDefault();const t=eventId(e),{note:o,codeLink:s}=getPaperEdits(t);saveNote(t,o),saveCodeLink(t,s),updatePaperTags(t,"memory-item-tags"),dispatch(findEl(t,"memory-item-edit"),"click"),findEl(t,"memory-item-save-edits").disabled=!0},handleCancelPaperEdit=e=>{e.preventDefault();const t=eventId(e),o=_state.papers[t];val(findEl(t,"form-note-textarea"),o.note),setHTMLEl(findEl(t,"memory-item-tags"),getTagsHTMLOptions(o)),dispatch(findEl(t,"memory-item-edit"),"click"),findEl(t,"memory-item-save-edits").disabled=!0},handleTogglePaperEdit=e=>{e.preventDefault();const t=eventId(e),o=findEl(t,"memory-item-edit"),s=$(findEl(t,"code-and-note")),a=$(findEl(t,"extended-item")),n=$(findEl(t,"tag-list")),r=$(findEl(t,"edit-tags")),i=$(findEl(t,"memory-item-tags")),d=$(findEl(t,"memory-item-actions"));o.classList.contains("expand-open")?(o.classList.remove("expand-open"),s.slideDown(250),n.slideDown(250),d.slideDown(250),a.slideUp(250),r.slideUp(250),i.select2("destroy")):(o.classList.add("expand-open"),i.select2({..._select2Options,width:"75%"}),hasClass(o,"has-monitoring")||i.on("change",monitorPaperEdits(t,!1)),o.classList.add("has-monitoring"),s.slideUp(250),n.slideUp(250),d.slideUp(250),a.slideDown(250),r.slideDown(250))},handleMemorySelectChange=e=>{const t=e.target.value;_state.sortKey=t,sortMemory(),displayMemoryTable(),setMemorySortArrow("down")},handleMemorySortArrow=e=>{"memory-sort-arrow-down"===document.querySelector("#memory-sort-arrow svg").id?setMemorySortArrow("up"):setMemorySortArrow("down"),reverseMemory(),displayMemoryTable()},handleFilterFavorites=()=>{const e=!_state.showFavorites;if(_state.showFavorites=e,e){addClass(document.getElementById("filter-favorites").querySelector("svg"),"favorite"),sortMemory(),_state.papersList=_state.papersList.filter(e=>e.favorite),displayMemoryTable(),setMemorySortArrow("down"),document.getElementById("memory-select").innerHTML+='<option value="favoriteDate">Last favoured</option>';const e=_state.papersList.length;setPlaceholder("memory-search",`Search ${e} entries...`)}else{removeClass(document.getElementById("filter-favorites").querySelector("svg"),"favorite"),"favoriteDate"===document.getElementById("memory-select").value&&(document.getElementById("memory-select").value="lastOpenDate",_state.sortKey="lastOpenDate"),document.querySelector('#memory-select option[value="favoriteDate"]').remove(),sortMemory(),setMemorySortArrow("down"),val("memory-search").trim()?dispatch("memory-search","keypress"):(_state.papersList=_state.sortedPapers,displayMemoryTable());const e=_state.sortedPapers.length;setPlaceholder("memory-search",`Search ${e} entries...`)}},handleMemorySearchKeyPress=e=>t=>{const o=val("memory-search").trim();(o||e||"Backspace"===t.key)&&(o.startsWith("t:")?filterMemoryByTags(o):o.startsWith("c:")?filterMemoryByCode(o):filterMemoryByString(o),displayMemoryTable())},handleMemorySearchKeyUp=e=>{if("Backspace"==e.key){var t=new Event("keypress");t.key="Backspace",dispatch("memory-search",t)}},handleCancelModalClick=()=>{document.getElementById("confirm-modal").remove()},handleConfirmModalClick=e=>{const t=e.target.id.split("--")[1];delete _state.papers[t],chrome.storage.local.set({papers:_state.papers},()=>{_state.papersList=Object.values(cleanPapers(_state.papers)),sortMemory(),displayMemoryTable(),document.getElementById("confirm-modal").remove(),console.log("Successfully deleted '"+title+"' from ArxivMemory"),_state.currentId===t&&updatePopupPaperNoMemory(),setPlaceholder("memory-search",`Search ${_state.papersList.length} entries ...`)})},handleTagClick=e=>{const t=e.target,o=t.textContent;val("memory-search",`t: ${o}`),dispatch("memory-search","keypress")},handleClearSearch=e=>{""===e.target.value&&dispatch("memory-search","clear-search")},findEl=(e,t)=>document.getElementById(`memory-item-container--${e.replace("\\.",".")}`).querySelector(`.${t}`),getTagsHTMLOptions=e=>{const t=new Set(e.tags);return Array.from(_state.paperTags).sort().map((e,o)=>{let s=`<option value="${e}"`;return t.has(e)&&(s+=' selected="selected" '),s+`>${e}</option>`}).join("")},updateAllPaperTagOptions=()=>{for(const e in _state.papers)if(_state.papers.hasOwnProperty(e)&&"__dataVersion"!==e){const t=_state.papers[e];setHTMLEl(`memory-item-tags--${e}`,getTagsHTMLOptions(t))}},updatePopupPaperNoMemory=()=>{const e='\n    <div style="font-size: 1.5rem;">This paper is not in your memory</div>\n    <h4> Refresh the page to add it back </h4>\n    ';setHTMLEl("isArxiv",e)},confirmDelete=e=>{const t=_state.papers[e].title;document.body.innerHTML+=`\n    <div id="confirm-modal">\n        <div style="width: 80%; padding: 32px 32px; text-align: center; font-size: 1.1rem;">\n            Are you sure you want to delete:<p>${t}</p>?\n        </div>\n        <div style="width: 100%; text-align: center; padding: 32px;">\n            <button style="padding: 8px 16px;" id="cancel-modal-button">Cancel</button>\n            <span style="min-width: 32px;"></span>\n            <button style="padding: 8px 16px;" id="confirm-modal-button--${e}">Confirm</button>\n        </div>\n    </div>`,addListener("cancel-modal-button","click",handleCancelModalClick),addListener(`confirm-modal-button--${e}`,"click",handleConfirmModalClick)},copyAndConfirmMemoryItem=(e,t,o,s)=>{copyTextToClipboard(t);const a=s?document.getElementById("popup-feedback-copied"):findEl(e,"memory-item-feedback");a&&(a.innerText=o,$(a).fadeIn(),setTimeout(()=>{$(a).fadeOut()},1e3))},focusExistingOrCreateNewCodeTab=e=>{const{origin:t}=new URL(e);chrome.tabs.query({url:`${t}/*`},t=>{for(const o of t)if(o.url.includes(e)){const e={active:!0},t={focused:!0};return void chrome.windows.getCurrent(s=>{s.id!==o.windowId?chrome.windows.update(o.windowId,t,()=>{chrome.tabs.update(o.id,e)}):chrome.tabs.update(o.id,e)})}chrome.tabs.create({url:e})})},focusExistingOrCreateNewPaperTab=e=>{const t=parseUrl(e.pdfLink).hostname;let o=e.pdfLink.split("/").reverse()[0].replace("-Paper.pdf","").replace(".pdf","");o.match(/\d{5}v\d+$/)&&"arxiv"===e.source&&(o=o.split("v")[0]),chrome.tabs.query({url:`*://${t}/*`},t=>{let s=[],a=[];const n=t.map(e=>e.url);let r=0;for(const e of n)e.indexOf(o)>=0&&(s.push(r),e.endsWith(".pdf")&&a.push(r)),r+=1;if(s.length>0){let e;e=a.length>0?t[a[0]]:t[s[0]];const o={active:!0},n={focused:!0};chrome.windows.getCurrent(t=>{t.id!==e.windowId?chrome.windows.update(e.windowId,n,()=>{chrome.tabs.update(e.id,o)}):chrome.tabs.update(e.id,o)})}else chrome.tabs.create({url:e.pdfLink});_state.papers[e.id].count+=1,chrome.storage.local.set({papers:_state.papers})})},saveNote=(e,t)=>{t=t.trim(),_state.papers[e].note=t,chrome.storage.local.set({papers:_state.papers},()=>{setHTMLEl(findEl(e,"memory-note-div"),t?`\n                <div class="memory-note-div memory-item-faded">\n                    <span class="note-content-header">Note:</span>\n                    <span class="note-content">${t}</span>\n                </div>`:'<div class="memory-note-div memory-item-faded"></div>');const o=document.getElementById(`popup-form-note-textarea--${e}`);val(o,t),val(findEl(e,"form-note-textarea"),t)})},saveCodeLink=(e,t)=>{t=t.trim(),_state.papers[e].codeLink=t,chrome.storage.local.set({papers:_state.papers},()=>{setHTMLEl(findEl(e,"memory-item-code-link"),t),setHTMLEl("popup-code-link",t),val(findEl(e,"form-code-input"),t),t?showId("popup-code-link"):hideId("popup-code-link");const o=document.getElementById(`popup-form-codeLink--${e}`);val(o,t)})},saveFavoriteItem=(e,t)=>{_state.papers[e].favorite=t,_state.papers[e].favoriteDate=(new Date).toJSON(),chrome.storage.local.set({papers:_state.papers},()=>{if(t?(addClass(`memory-item-container--${e}`,"favorite"),addClass(findEl(e,"memory-item-favorite").querySelector("svg"),"favorite")):(removeClass(`memory-item-container--${e}`,"favorite"),removeClass(findEl(e,"memory-item-favorite").querySelector("svg"),"favorite")),"favoriteDate"===_state.sortKey){t||(sortMemory(),displayMemoryTable());const e=_state.sortedPapers.filter(e=>e.favorite).length,o=document.getElementById("memory-search");o&&setPlaceholder(o,`Search ${e} entries`)}let o=document.getElementById(`checkFavorite--${e}`);o&&(o.checked=t)})},setMemorySortArrow=e=>{let t;t="up"===e?'<svg class="memory-sort-arrow-svg" id="memory-sort-arrow-up">\n                    <use xlink:href="../../icons/tabler-sprite-nostroke.svg#tabler-arrow-narrow-up" />\n                </svg>':'<svg class="memory-sort-arrow-svg" id="memory-sort-arrow-down">\n                    <use xlink:href="../../icons/tabler-sprite-nostroke.svg#tabler-arrow-narrow-down" />\n                </svg>',setHTMLEl("memory-sort-arrow",t)},orderPapers=(e,t)=>{let o=e[_state.sortKey],s=t[_state.sortKey];return void 0===o&&(o=""),void 0===s&&(s=""),"string"==typeof o&&(o=o.toLowerCase(),s=s.toLowerCase()),_descendingSortKeys.indexOf(_state.sortKey)>=0?o>s?-1:1:o>s?1:-1},sortMemory=()=>{_state.sortedPapers=Object.values(cleanPapers(_state.papers)),_state.sortedPapers.sort(orderPapers),_state.papersList.sort(orderPapers)},reverseMemory=()=>{_state.sortedPapers.reverse(),_state.papersList.reverse()},filterMemoryByString=e=>{const t=e.split(" ");let o=[];for(const e of _state.sortedPapers){const s=e.title.toLowerCase(),a=e.author.toLowerCase(),n=e.note.toLowerCase(),r=e.id.split("-")[0].toLowerCase();t.every(e=>s.includes(e)||a.includes(e)||n.includes(e)||r.includes(e))&&(_state.showFavorites&&!e.favorite||o.push(e))}_state.papersList=o},filterMemoryByTags=e=>{const t=e.replace("t:","").toLowerCase().split(" ");let o=[];for(const e of _state.sortedPapers){const s=e.tags.map(e=>e.toLowerCase());t.every(e=>s.some(t=>t.indexOf(e)>=0))&&(_state.showFavorites&&!e.favorite||o.push(e))}_state.papersList=o},filterMemoryByCode=e=>{const t=e.replace("c:","").toLowerCase().split(" ");let o=[];for(const e of _state.sortedPapers){let s=e.codeLink||"";s=s.toLowerCase(),t.every(e=>s.includes(e))&&(_state.showFavorites&&!e.favorite||o.push(e))}_state.papersList=o},updatePaperTagsHTML=e=>{setHTMLEl(findEl(e,"tag-list"),_state.papers[e].tags.map(e=>`<span class="memory-tag">${e}</span>`).join(""))},updateTagOptions=e=>{const t=getTagsHTMLOptions(_state.papers[e]);updateAllPaperTagOptions(),setHTMLEl(`popup-item-tags--${e}`,t)},updatePaperTags=(e,t)=>{let o;o=t.startsWith("#")?document.getElementById(t.replace("#","")):findEl(e,t);const s=parseTags(o);updated=!1,arraysIdentical(_state.papers[e].tags,s)||(updated=!0),_state.papers[e].tags=s,updated&&chrome.storage.local.set({papers:_state.papers},()=>{makeTags(),updateTagOptions(e),updatePaperTagsHTML(e)})},makeTags=()=>{let e=new Set;for(const t of _state.sortedPapers)for(const o of t.tags)e.add(o);_state.paperTags=Array.from(e),_state.paperTags.sort()},displayMemoryTable=()=>{const e=Date.now();var t=document.getElementById("memory-table");t.innerHTML="";let o=[];for(const e of _state.papersList)try{o.push(getMemoryItemHTML(e))}catch(t){console.log("displayMemoryTable error:"),console.log(t),console.log(e)}t.innerHTML=o.join("");const s=Date.now();console.log("[displayMemoryTable] Rendering duration (s): "+(s-e)/1e3),addEventToClass(".back-to-focus","click",handleBackToFocus),addEventToClass(".delete-memory-item","click",handleDeleteItem),addEventToClass(".memory-item-link","click",handleOpenItemLink),addEventToClass(".memory-item-code-link","click",handleOpenItemCodeLink),addEventToClass(".memory-item-md","click",handleCopyMarkdownLink),addEventToClass(".memory-item-bibtext","click",handleCopyBibtex),addEventToClass(".memory-item-copy-link","click",handleCopyPDFLink),addEventToClass(".memory-item-favorite","click",handleAddItemToFavorites),addEventToClass(".cancel-note-form","click",handleCancelPaperEdit),addEventToClass(".memory-item-edit","click",handleTogglePaperEdit),addEventToClass(".memory-tag","click",handleTagClick),setFormChangeListener(void 0,!1),addEventToClass(".form-note-textarea","focus",handleTextareaFocus),addEventToClass(".form-note","submit",handleEditPaperFormSubmit);const a=Date.now();console.log("[displayMemoryTable] Listeners duration (s): "+(a-s)/1e3)},openMemory=()=>{_state.menuIsOpen&&closeMenu(),_state.memoryIsOpen=!0,$("#memory-container").slideDown({duration:250,easing:"easeOutQuint",complete:()=>{setTimeout(()=>{dispatch("memory-search","focus")},150)}}),$("#tabler-menu").fadeOut(200),val("memory-select","lastOpenDate"),setMemorySortArrow("down"),$("#memory-switch-text-on").hide(),$("#memory-switch-text-off").show(),addListener("memory-search","search",handleClearSearch)},makeMemoryHTML=async()=>{const e=Date.now()/1e3;setPlaceholder("memory-search",`Search ${_state.papersList.length} entries ...`);const t=Date.now()/1e3;displayMemoryTable(),_state.papersList.length<20?delayTime=0:_state.papersList.length<50&&(delayTime=300);const o=Date.now()/1e3;console.log("Time to display table (s):"+(o-t)),addListener("memory-search","keypress",delay(handleMemorySearchKeyPress(),delayTime)),addListener("memory-search","clear-search",handleMemorySearchKeyPress(!0)),addListener("memory-search","keyup",handleMemorySearchKeyUp),addListener("filter-favorites","click",handleFilterFavorites),addListener("memory-select","change",handleMemorySelectChange),addListener("memory-sort-arrow","click",handleMemorySortArrow);const s=Date.now()/1e3;console.log("Time to add events listeners (s):"+(s-o)),console.log("Total time to make (async) (s):"+(s-e))},closeMemory=()=>{$("#memory-container").slideUp({duration:300,easing:"easeOutQuint"}),$("#memory-switch-text-off").hide(),$("#memory-switch-text-on").show(),$("#tabler-menu").fadeIn(200),val("memory-search",""),dispatch("memory-search","clear-search"),_state.memoryIsOpen=!1,_state.showFavorites&&dispatch("filter-favorites","click")},closeMenu=()=>{$("#menuDiv").slideUp({duration:300,easing:"easeOutQuint"})&&$("#tabler-menu").fadeOut(()=>{setHTMLEl("tabler-menu",tablerSvg("settings","tabler-menu-svg",["tabler-icon"])),$("#tabler-menu").fadeIn()}),_state.menuIsOpen=!1},openMenu=()=>{$("#menuDiv").slideDown({duration:300,easing:"easeOutQuint"})&&$("#tabler-menu").fadeOut(()=>{setHTMLEl("tabler-menu",tablerSvg("circle-x","close-menu-btn",["tabler-icon","menu-svg"])),$("#tabler-menu").fadeIn()}),_state.menuIsOpen=!0},getAndTrackPopupMenuChecks=(e,t)=>{let o={};for(const s of t)o[s]=!e.hasOwnProperty(s)||e[s],document.getElementById(s).checked=o[s];chrome.storage.local.set(o);for(const e of t)addListener(e,"change",()=>{const t=document.getElementById(e).checked;chrome.storage.local.set({[e]:t},function(){console.log(`Settings saved for ${e} (${t})`)})})},setStandardPopupClicks=()=>{addListener("helpGithubLink","click",()=>{chrome.tabs.create({url:"https://github.com/vict0rsch/ArxivMemory"})}),addListener("keyboardShortcuts","click",()=>{chrome.tabs.create({url:"https://github.com/vict0rsch/ArxivTools#keyboard-navigation"})}),addListener("tabler-menu","click",()=>{_state.menuIsOpen?closeMenu():openMenu()}),addListener("memory-switch","click",()=>{_state.memoryIsOpen?closeMemory():openMemory()}),addListener("download-arxivmemory","click",()=>{const e=(new Date).toLocaleString();chrome.storage.local.get("papers",({papers:t})=>{const o=t.__dataVersion;downloadTextFile(JSON.stringify(t),`arxiv-memory-${o}-${e}.json`,"text/json")})})},setAndHandleCustomPDFFunction=menu=>{menu.pdfTitleFn&&"string"==typeof menu.pdfTitleFn&&(_state.pdfTitleFn=getPdfFn(menu.pdfTitleFn)),chrome.storage.local.set({pdfTitleFn:_state.pdfTitleFn.toString()}),val("customPdfTitleTextarea",_state.pdfTitleFn.toString()),addListener("saveCustomPdf","click",()=>{const code=val("customPdfTitleTextarea").trim();try{const fn=eval(code),tested=fn("test","1.2");if("string"!=typeof tested)throw Error("Custom function returns the wrong type:",typeof tested,tested);const savedFeedback='<span style="color: green">Saved!</span>';setHTMLEl("customPdfFeedback",savedFeedback),chrome.storage.local.set({pdfTitleFn:code}),_state.pdfTitleFn=fn,setTimeout(()=>{setHTMLEl("customPdfFeedback","")},1e3)}catch(e){console.log("setAndHandleCustomPDFFunction error:");const t=`<span style="color: red">${e}</span>`;savedFeedback("customPdfFeedback",t)}}),document.getElementById("defaultCustomPdf").addEventListener("click",()=>{const e=defaultPDFTitleFn.toString(),t='<span style="color: green">Saved!</span>';chrome.storage.local.set({pdfTitleFn:e}),_state.pdfTitleFn=defaultPDFTitleFn,val("customPdfTitleTextarea",e),setHTMLEl("customPdfFeedback",t),setTimeout(()=>{setHTMLEl("customPdfFeedback","")},1e3)})},popupMain=async(e,t)=>{if(addListener(document,"keydown",handlePopupKeydown),setStandardPopupClicks(),t){showId("isArxiv","flex");const t=parseIdFromUrl(e);if(_state.currentId=t,!_state.papers.hasOwnProperty(t))return console.log("Unknown id "+t),void updatePopupPaperNoMemory();const o=_state.papers[t],s=o.id.replace(".","\\.");setTextId("popup-paper-title",o.title.replaceAll("\n","")),setTextId("popup-authors",o.author.replaceAll(" and ",", ")),o.codeLink&&(showId("popup-code-link"),setTextId("popup-code-link",o.codeLink)),setHTMLEl("popup-memory-edit",getPopupEditFormHTML(o)),setHTMLEl("popup-copy-icons",getPopupPaperIconsHTML(o,e)),document.getElementById(`checkFavorite--${t}`).checked=o.favorite,$(`#popup-item-tags--${s}`).select2({..._select2Options,width:"87%"}),document.body.style.height="auto",addListener(`popup-form-note-textarea--${t}`,"focus",()=>{var e=this;textareaFocusEnd(e)}),setFormChangeListener(t,!0),addListener(`popup-save-edits--${t}`,"click",()=>{const{note:e,codeLink:o,favorite:s}=getPaperEdits(t,!0);updatePaperTags(t,`#popup-item-tags--${t}`),saveNote(t,e),saveCodeLink(t,o),saveFavoriteItem(t,s),setHTMLEl("popup-feedback-copied","Saved tags, code, note & favorite!"),$("#popup-feedback-copied").fadeIn(200),setTimeout(()=>{$("#popup-feedback-copied").fadeOut(200)},1500),document.getElementById(`popup-save-edits--${t}`).disabled=!0}),addListener(`popup-memory-item-link--${t}`,"click",()=>{chrome.tabs.update({url:`https://arxiv.org/abs/${o.id.replace("Arxiv-","")}`}),window.close()}),addListener("popup-code-link","click",()=>{const e=document.getElementById("popup-code-link").textContent;e&&focusExistingOrCreateNewCodeTab(e)}),addListener(`popup-memory-item-copy-link--${t}`,"click",()=>{const e=_state.papers[t].pdfLink;copyAndConfirmMemoryItem(t,e,"Pdf link copied!",!0)}),addListener(`popup-memory-item-md--${t}`,"click",()=>{const e=_state.papers[t].md;copyAndConfirmMemoryItem(t,e,"MarkDown link copied!",!0)}),addListener(`popup-memory-item-bibtex--${t}`,"click",()=>{const e=formatBibtext(_state.papers[t].bibtext);copyAndConfirmMemoryItem(t,e,"Bibtex citation copied!",!0)}),addListener(`popup-memory-item-download--${t}`,"click",()=>{let e=statePdfTitle(o.title,o.id);console.log({pdfTitle:e}),chrome.downloads.download({url:o.pdfLink,filename:e.replaceAll(":","_")})})}const o=await getStorage(_menuStorageKeys);getAndTrackPopupMenuChecks(o,_menuCheckNames),setAndHandleCustomPDFFunction(o)};$(()=>{const e={active:!0,lastFocusedWindow:!0};chrome.tabs.query(e,async e=>{const t=e[0].url,o=isPaper(t);console.log("is: ",o);const s=Object.values(o).some(e=>e);console.log("isKnownPage: ",s),s||showId("notArxiv"),await initState(),makeMemoryHTML(),popupMain(t,s)})});const getMemoryItemHTML=e=>{const t=new Date(e.addDate).toLocaleString().replace(",",""),o=new Date(e.lastOpenDate).toLocaleString().replace(",",""),s=e.id.split("_")[0].split(".")[0],a=e.note||"",n=e.id,r=new Set(e.tags),i=getTagsHTMLOptions(e),d=e.favorite?"favorite":"",l={edit:"\"Edit paper details&#13;&#10;(or press 'e' when this paper is focused,&#13;&#10; i.e. when you navigated to it with 'tab')\"",pdfLink:`"Open ${e.pdfLink}"`,copyPdfLink:'"Copy pdf link"',copyMd:'"Copy Markdown-formatted link"',copyBibtext:'"Copy Bibtex citation"',visits:'"Number of times you have loaded&#13;&#10;the paper\'s Page or PDF"'};let c=`\n    <small class="memory-item-faded">\n        <span class="memory-item-code-link">${e.codeLink||""}</span>\n    </small>\n    `,m='<div class="memory-note-div memory-item-faded"></div>';return e.note&&(m=`\n        <div class="memory-note-div memory-item-faded">\n            <span class="note-content-header">Note:</span>\n            <span class="note-content">${a}</span>\n        </div>\n        `),`\n    <div class="memory-item-container ${d}" tabindex="0" id="memory-item-container--${n}">\n\n        <h4 class="memory-item-title" title="Added ${t}&#13;&#10;Last open ${o}">\n                <span class="memory-item-favorite">\n                    ${tablerSvg("star","",["memory-item-favorite-svg",d])}\n                </span>\n                ${e.title}\n        </h4>\n        <div class="memory-item-tags-div">\n            <small class="tag-list">\n                ${Array.from(r).map(e=>`<span class="memory-tag">${e}</span>`).join("")}\n            </small>\n            <div class="edit-tags">\n                <div style="display:flex; align-items: center"; justify-content: space-between">\n                    <select class="memory-item-tags" id="memory-item-tags--${n}" multiple="multiple">\n                        ${i}\n                    </select>\n                </div>\n            </div>\n        </div>\n        <small class="authors">${cutAuthors(e.author)}</small>\n        \n        <div class="code-and-note">\n            ${c}\n            ${m}\n        </div>\n\n        <div class="memory-item-actions">\n\n            <div style="display: flex; align-items: center">\n                <div class="memory-item-edit memory-item-svg-div" title=${l.edit} >\n                    ${tablerSvg("writing","",["memory-icon-svg"])}\n                </div>\n                \n                <small class="memory-item-faded">\n                        ${s}\n                </small>\n                        \n            </div>\n\n            <div class="memory-item-link memory-item-svg-div"  title=${l.pdfLink} >\n                ${tablerSvg("file-symlink","",["memory-icon-svg"])}\n            </div>\n                \n            <div class="memory-item-copy-link memory-item-svg-div" title=${l.copyPdfLink} >\n                ${tablerSvg("link","",["memory-icon-svg"])}\n            </div>\n\n            <div class="memory-item-md memory-item-svg-div" title=${l.copyMd} >\n                ${tablerSvg("clipboard-list","",["memory-icon-svg"])}\n            </div>\n\n            <div class="memory-item-bibtext memory-item-svg-div" title=${l.copyBibtext}>\n                ${tablerSvg("archive","",["memory-icon-svg"])}\n            </div>\n\n            <span style="color: green; display: none" class="memory-item-feedback"></span>\n            \n            <div title=${l.visits} class="memory-item-faded">\n                Visits: ${e.count}\n            </div>\n\n        </div>\n\n        <div class="extended-item" style="display: none">\n            <div class="item-note">\n                <form class="form-note">\n                    <div class="textarea-wrapper">\n                        <span class="label">Code:</span>\n                        <input type="text" class="form-code-input" value="${e.codeLink||""}">\n                    </div>\n                    <div class="textarea-wrapper">\n                        <span class="label">Note:</span>\n                        <textarea rows="3" class="form-note-textarea">${a}</textarea>\n                    </div>\n                    <div class="form-note-buttons">\n                        <button class="memory-item-save-edits" type="submit" disabled >Save</button>\n                        <button class="cancel-note-form back-to-focus">Cancel</button>\n                    </div>\n                </form>\n            </div>\n        </div>\n\n        <div class="delete-memory-item"> - </div>\n    </div>\n    `},getPopupEditFormHTML=e=>{const t=e.id,o=getTagsHTMLOptions(e),s=e.note||"",a="";return`\n    <div style="max-width: 100%; display: flex; justify-content: space-between; align-items: center; padding: 4px 16px;">\n        <div style="width: 100%">\n            <div style="width: 100%; display: flex; justify-content: space-between; align-items: center;">\n                <span class="label">Tags:</span>\n                <select id="popup-item-tags--${t}"class="memory-item-tags" multiple="multiple">\n                    ${o}\n                </select>\n            </div>\n            <div \n                class="form-note" \n                id="popup-form-note--${t}" \n                style="width: 100%; display: flex; justify-content: space-between; align-items: center; margin-top: 8px; flex-direction: column;"\n            >\n                <div class="textarea-wrapper w-100 mr-0">\n                    <span class="label">Code:</span>\n                    <input \n                        id="popup-form-codeLink--${t}" \n                        type="text" \n                        class="form-code-input mt-0 noMemoryOnA" \n                        value="${e.codeLink||""}"\n                    >\n                </div>\n                <div class="textarea-wrapper w-100 mr-0">\n                    <span class="label">Note:</span>\n                    <textarea \n                        rows="3" \n                        style="width:85%;" \n                        class="noMemoryOnA"\n                        id="popup-form-note-textarea--${t}"\n                    >${s}</textarea>\n                </div>\n            </div>\n            <div style="display: flex; justify-content: space-between; align-items: center">\n                <div style="display: flex; justify-content: flex-start; align-items: center">\n                    <label class="label" for="checkFavorite">Favorite: </label>\n                    <input ${a} class="switch" type="checkbox" id="checkFavorite--${t}" name="checkFavorite" value="checkFavorite">\n                </div>\n                <button style="padding: 6px 16px;" disabled class="back-to-focus" id="popup-save-edits--${t}">Save</button>\n            </div>\n        </div>\n        <div>\n            \n        </div>\n    </div>`},getPopupPaperIconsHTML=(e,t)=>{const o=e.id,s="arxiv"!==e.source||t.indexOf(".pdf")<0?"none":"inherit";return`\n    <div\n        class="memory-item-svg-div" \n        id="popup-memory-item-link--${o}"\n        title="Open Paper HTML Page"\n        style="display: ${s}"\n    >\n        ${tablerSvg("external-link","",["popup-click-svg"])}\n    </div>\n    <div \n        class="memory-item-svg-div"\n        id="popup-memory-item-copy-link--${o}"\n        title="Copy pdf link" \n    >\n        ${tablerSvg("link","",["popup-click-svg"])}\n    </div>\n\n    <div \n        class="memory-item-svg-div"\n        id="popup-memory-item-md--${o}"\n        title="Copy Markdown-formatted link" \n    >\n        ${tablerSvg("clipboard-list","",["popup-click-svg"])}\n    </div>\n\n    <div \n        class="memory-item-svg-div"\n        id="popup-memory-item-bibtex--${o}"\n        title="Copy Bibtex citation" \n    >\n        ${tablerSvg("archive","",["popup-click-svg"])}\n    </div>\n\n    <div \n        class="memory-item-svg-div"\n        id="popup-memory-item-download--${o}"\n        title="Download pdf" \n    >\n        ${tablerSvg("file-download","",["popup-click-svg"])}\n    </div>`};