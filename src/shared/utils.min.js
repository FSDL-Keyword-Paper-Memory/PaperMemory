function delay(e,t){let o=0;return function(...n){clearTimeout(o),o=setTimeout(e.bind(this,...n),t||0)}}function fallbackCopyTextToClipboard(e){var t=document.createElement("textarea");t.value=e,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{var o=document.execCommand("copy"),n=o?"successful":"unsuccessful";console.log("Fallback: Copying text command was "+n)}catch(e){console.error("Fallback: Oops, unable to copy",e)}document.body.removeChild(t)}function copyTextToClipboard(e){navigator.clipboard?navigator.clipboard.writeText(e).then(function(){console.log("Async: Copying to clipboard was successful!")},function(e){console.error("Async: Could not copy text: ",e)}):fallbackCopyTextToClipboard(e)}function parseUrl(e){var t=document.createElement("a");return t.href=e,t}const downloadTextFile=(e,t,o)=>{var n=document.createElement("a"),a=new Blob([e],{type:o});n.href=URL.createObjectURL(a),n.download=t,n.click()},eventId=e=>{const t=e.target.id.split("--")[1],o=t.replace(".","\\.");return{id:t,eid:o}},download_file=(e,t)=>{if(window.ActiveXObject){if(window.ActiveXObject&&document.execCommand){var o=window.open(e,"_blank");o.document.close(),o.document.execCommand("SaveAs",!0,t||e),o.close()}}else{var n=document.createElement("a");n.href=e,n.target="_blank";var a=e.substring(e.lastIndexOf("/")+1);if(n.download=t||a,navigator.userAgent.toLowerCase().match(/(ipad|iphone|safari)/)&&navigator.userAgent.search("Chrome")<0)document.location=n.href;else{var r=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});n.dispatchEvent(r),(window.URL||window.webkitURL).revokeObjectURL(n.href)}}},defaultPDFTitleFn=(e,t)=>(e=e.replaceAll("\n"," ").replace(/\s\s+/g," "),`${e} - ${t}.pdf`),getPdfFn=code=>{try{pdfTitleFn=eval(code)}catch(e){console.log("Error parsing pdf title function. Function string then error:"),console.log(code),console.log(e),pdfTitleFn=defaultPDFTitleFn}try{pdfTitleFn("test","1.2")}catch(e){console.log("Error testing the user's pdf title function. Function string then error:"),console.log(code),console.log(e),pdfTitleFn=defaultPDFTitleFn}return pdfTitleFn},migrateData=async(e,t)=>{try{if(e.hasOwnProperty("__dataVersion")&&e.__dataVersion===t)return delete e.__dataVersion,e;delete e.__dataVersion;for(const t in e)e[t].hasOwnProperty("bibtext")||(e[t].bibtext="",console.log("Migrating bibtext for "+t)),e[t].pdfLink.endsWith(".pdf")||(e[t].pdfLink=e[t].pdfLink+".pdf"),e[t].source||(e[t].id.includes("NeurIPS")?e[t].source="neurips":e[t].source="arxiv");return e.__dataVersion=t,chrome.storage.local.set({papers:e},()=>{console.log("Migrated papers:"),console.log(e)}),delete e.__dataVersion,e}catch(t){return console.log("Error migrating data:"),console.log(t),e}};var state={menuIsOpen:!1,memoryIsOpen:!1,papers:{},papersList:[],sortedPapers:[],sortKey:"",paperTags:new Set,dataVersion:0,pdfTitleFn:defaultPDFTitleFn};const statePdfTitle=(e,t)=>{let o;try{o=state.pdfTitleFn(e,t)}catch(n){o=defaultPDFTitleFn(e,t)}return o.replaceAll("\n"," ").replace(/\s\s+/g," ")},initState=async(e,t)=>{if(console.log("Found papers:"),console.log(e),state.dataVersion=4,e=await migrateData(e,state.dataVersion),t)return e;state.papers=e,state.papersList=Object.values(e),state.sortKey="lastOpenDate",sortMemory(),makeTags()};