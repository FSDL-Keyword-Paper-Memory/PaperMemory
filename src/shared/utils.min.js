var global={};"undefined"!=typeof window&&(global=window),global.state={dataVersion:0,memoryIsOpen:!1,menuIsOpen:!1,papers:{},papersList:[],paperTags:new Set,pdfTitleFn:null,showFavorites:!1,sortedPapers:[],sortKey:"",papersReady:!1},global.descendingSortKeys=["addDate","count","lastOpenDate","favoriteDate"],global.select2Options={placeholder:"Tag paper",maximumSelectionLength:5,allowClear:!0,tags:!0,tokenSeparators:[","," "]},global.menuCheckNames=["checkBib","checkMd","checkDownload","checkPdfTitle","checkFeedback","checkDarkMode","checkDirectOpen"],global.menuCheckDefaultFalse=["checkDarkMode","checkDirectOpen"],global.menuStorageKeys=[...global.menuCheckNames,"pdfTitleFn"],global.knownPaperPages={arxiv:["arxiv.org/abs/","arxiv.org/pdf/"],neurips:["neurips.cc/paper/","nips.cc/paper/"],cvf:["openaccess.thecvf.com/content"],openreview:["openreview.net/forum","openreview.net/pdf"],biorxiv:["biorxiv.org/content"],pmlr:["proceedings.mlr.press/"]},global.overrideORConfs={"robot-learning":"CoRL",ijcai:"IJCAI"},global.overridePMLRConfs={"Conference on Learning Theory":"CoLT","International Conference on Machine Learning":"ICML","Conference on Uncertainty in Artificial Intelligence":"UAI","Conference on Robot Learning":"CoRL","International Conference on Artificial Intelligence and Statistics":"AISTATS","International Conference on Algorithmic Learning Theory":"ALT"},global.englishStopWords=new Set([["i","me","my","myself","we","our","ours","ourselves","you","your","yours","yourself","yourselves","he","him","his","himself","she","her","hers","herself","it","its","itself","they","them","their","theirs","themselves","what","which","who","whom","this","that","these","those","am","is","are","was","were","be","been","being","have","has","had","having","do","does","did","doing","a","an","the","and","but","if","or","because","as","until","while","of","at","by","for","with","about","against","between","into","through","during","before","after","above","below","to","from","up","down","in","out","on","off","over","under","again","further","then","once","here","there","when","where","why","how","all","any","both","each","few","more","most","other","some","such","no","nor","not","only","own","same","so","than","too","very","s","t","can","will","just","don","should","now"]]),$.easing.jswing=$.easing.swing,$.extend($.easing,{def:"easeOutQuad",swing:(e,t,r,a,n)=>$.easing[$.easing.def](e,t,r,a,n),easeInQuad:(e,t,r,a,n)=>a*(t/=n)*t+r,easeOutQuad:(e,t,r,a,n)=>-a*(t/=n)*(t-2)+r,easeInOutQuad:(e,t,r,a,n)=>(t/=n/2)<1?a/2*t*t+r:-a/2*(--t*(t-2)-1)+r,easeInCubic:(e,t,r,a,n)=>a*(t/=n)*t*t+r,easeOutCubic:(e,t,r,a,n)=>a*((t=t/n-1)*t*t+1)+r,easeInOutCubic:(e,t,r,a,n)=>(t/=n/2)<1?a/2*t*t*t+r:a/2*((t-=2)*t*t+2)+r,easeInQuart:(e,t,r,a,n)=>a*(t/=n)*t*t*t+r,easeOutQuart:(e,t,r,a,n)=>-a*((t=t/n-1)*t*t*t-1)+r,easeInOutQuart:(e,t,r,a,n)=>(t/=n/2)<1?a/2*t*t*t*t+r:-a/2*((t-=2)*t*t*t-2)+r,easeInQuint:(e,t,r,a,n)=>a*(t/=n)*t*t*t*t+r,easeOutQuint:(e,t,r,a,n)=>a*((t=t/n-1)*t*t*t*t+1)+r,easeInOutQuint:(e,t,r,a,n)=>(t/=n/2)<1?a/2*t*t*t*t*t+r:a/2*((t-=2)*t*t*t*t+2)+r,easeInSine:(e,t,r,a,n)=>-a*Math.cos(t/n*(Math.PI/2))+a+r,easeOutSine:(e,t,r,a,n)=>a*Math.sin(t/n*(Math.PI/2))+r,easeInOutSine:(e,t,r,a,n)=>-a/2*(Math.cos(Math.PI*t/n)-1)+r,easeInExpo:(e,t,r,a,n)=>0==t?r:a*Math.pow(2,10*(t/n-1))+r,easeOutExpo:(e,t,r,a,n)=>t==n?r+a:a*(1-Math.pow(2,-10*t/n))+r,easeInOutExpo:(e,t,r,a,n)=>0==t?r:t==n?r+a:(t/=n/2)<1?a/2*Math.pow(2,10*(t-1))+r:a/2*(2-Math.pow(2,-10*--t))+r,easeInCirc:(e,t,r,a,n)=>-a*(Math.sqrt(1-(t/=n)*t)-1)+r,easeOutCirc:(e,t,r,a,n)=>a*Math.sqrt(1-(t=t/n-1)*t)+r,easeInOutCirc:(e,t,r,a,n)=>(t/=n/2)<1?-a/2*(Math.sqrt(1-t*t)-1)+r:a/2*(Math.sqrt(1-(t-=2)*t)+1)+r,easeInElastic:(e,t,r,a,n)=>{var o=1.70158,s=0,i=a;if(0==t)return r;if(1==(t/=n))return r+a;if(s||(s=.3*n),i<Math.abs(a)){i=a;o=s/4}else o=s/(2*Math.PI)*Math.asin(a/i);return-i*Math.pow(2,10*(t-=1))*Math.sin((t*n-o)*(2*Math.PI)/s)+r},easeOutElastic:(e,t,r,a,n)=>{var o=1.70158,s=0,i=a;if(0==t)return r;if(1==(t/=n))return r+a;if(s||(s=.3*n),i<Math.abs(a)){i=a;o=s/4}else o=s/(2*Math.PI)*Math.asin(a/i);return i*Math.pow(2,-10*t)*Math.sin((t*n-o)*(2*Math.PI)/s)+a+r},easeInOutElastic:(e,t,r,a,n)=>{var o=1.70158,s=0,i=a;if(0==t)return r;if(2==(t/=n/2))return r+a;if(s||(s=n*(.3*1.5)),i<Math.abs(a)){i=a;o=s/4}else o=s/(2*Math.PI)*Math.asin(a/i);return t<1?i*Math.pow(2,10*(t-=1))*Math.sin((t*n-o)*(2*Math.PI)/s)*-.5+r:i*Math.pow(2,-10*(t-=1))*Math.sin((t*n-o)*(2*Math.PI)/s)*.5+a+r},easeInBack:(e,t,r,a,n,o)=>(null==o&&(o=1.70158),a*(t/=n)*t*((o+1)*t-o)+r),easeOutBack:(e,t,r,a,n,o)=>(null==o&&(o=1.70158),a*((t=t/n-1)*t*((o+1)*t+o)+1)+r),easeInOutBack:(e,t,r,a,n,o)=>(null==o&&(o=1.70158),(t/=n/2)<1?a/2*(t*t*((1+(o*=1.525))*t-o))+r:a/2*((t-=2)*t*((1+(o*=1.525))*t+o)+2)+r),easeInBounce:(e,t,r,a,n)=>a-$.easing.easeOutBounce(e,n-t,0,a,n)+r,easeOutBounce:(e,t,r,a,n)=>(t/=n)<1/2.75?a*(7.5625*t*t)+r:t<2/2.75?a*(7.5625*(t-=1.5/2.75)*t+.75)+r:t<2.5/2.75?a*(7.5625*(t-=2.25/2.75)*t+.9375)+r:a*(7.5625*(t-=2.625/2.75)*t+.984375)+r,easeInOutBounce:(e,t,r,a,n)=>t<n/2?.5*$.easing.easeInBounce(e,2*t,0,a,n)+r:.5*$.easing.easeOutBounce(e,2*t-n,0,a,n)+.5*a+r});const info=(...e)=>{console.log("%c"+e.join(" "),"color: #328DD2")},getDisplayId=e=>(e=e.split("_")[0].split(".")[0],e.startsWith("OR-")||(e=e.split("-").slice(0,2).join("-")),e),defaultPDFTitleFn=(e,t)=>(e=e.replaceAll("\n"," ").replace(/\s\s+/g," "),t=t.split("_")[0].split(".")[0],`${e} - ${t}.pdf`),delay=(e,t)=>{let r=0;return(...a)=>{clearTimeout(r),r=setTimeout(e.bind(this,...a),t||0)}},cleanPapers=e=>{let t={...e};return delete t.__dataVersion,t},capitalize=e=>e.charAt(0).toUpperCase()+e.slice(1),firstNonStopLowercase=e=>{let t=e.toLowerCase(),r=t.split(" ").map(e=>e.replace(/[^0-9a-z]/gi,"")),a=r.filter(e=>global.englishStopWords.has(e));return a.length>0?a[0]:r[0]},fallbackCopyTextToClipboard=e=>{var t=document.createElement("textarea");t.value=e,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{var r=document.execCommand("copy"),a=r?"successful":"unsuccessful";console.log("Fallback: Copying text command was "+a)}catch(e){console.error("Fallback: Oops, unable to copy",e)}document.body.removeChild(t)},copyTextToClipboard=e=>{navigator.clipboard?navigator.clipboard.writeText(e).then(()=>{console.log("Async: Copying to clipboard was successful!")},e=>{console.error("Async: Could not copy text: ",e)}):fallbackCopyTextToClipboard(e)},parseUrl=e=>{var t=document.createElement("a");return t.href=e,t},downloadTextFile=(e,t,r)=>{var a=document.createElement("a");if("text/plain"===r)e=e.replace(/\\n/g,"%0D%0A").replace(/"/g,""),a.download=t,a.href="data:text/plain,"+e;else{var n=new Blob([e],{type:r});a.href=URL.createObjectURL(n),a.download=t}a.click()},eventId=e=>e.target.closest(".memory-container").id.split("--")[1],downloadFile=(e,t)=>{if(window.ActiveXObject){if(window.ActiveXObject&&document.execCommand){var r=window.open(e,"_blank");r.document.close(),r.document.execCommand("SaveAs",!0,t||e),r.close()}}else{var a=document.createElement("a");a.href=e,a.target="_blank";var n=e.substring(e.lastIndexOf("/")+1);if(a.download=t||n,navigator.userAgent.toLowerCase().match(/(ipad|iphone|safari)/)&&navigator.userAgent.search("Chrome")<0)document.location=a.href;else{var o=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});a.dispatchEvent(o),(window.URL||window.webkitURL).revokeObjectURL(a.href)}}},getPdfFn=code=>{try{pdfTitleFn=eval(code)}catch(e){console.log("Error parsing pdf title function. Function string then error:"),console.log(code),console.log(e),pdfTitleFn=defaultPDFTitleFn}try{pdfTitleFn("test","1.2")}catch(e){console.log("Error testing the user's pdf title function. Function string then error:"),console.log(code),console.log(e),pdfTitleFn=defaultPDFTitleFn}return pdfTitleFn},migrateData=async(e,t,r=!0)=>{if(void 0===e)return chrome.storage.local.set({papers:{__dataVersion:t}}),{papers:{__dataVersion:t},success:!0};const a=e.__dataVersion||-1;var n=[];const o=210;let s={...e};try{if(a===o)return{papers:e,success:!0};r&&backupData({...e}),delete e.__dataVersion;for(const t in e){if(a<5&&(info("Applying migration 5"),e[t].hasOwnProperty("bibtex")||(e[t].bibtex="",console.log("Migrating bibtex for "+t)),e[t].pdfLink.endsWith(".pdf")||(e[t].pdfLink=e[t].pdfLink+".pdf"),e[t].codeLink||(e[t].codeLink=""),e[t].source||(e[t].id.includes("NeurIPS")?e[t].source="neurips":e[t].source="arxiv")),a<208&&(info("Applying migration 0.2.8"),"arxiv"!==e[t].source&&e[t].md.includes("https://arxiv.com/abs/")&&(e[t].md=`[${e[t].title}](${e[t].pdfLink})`),"arxiv"!==e[t].source&&e[t].pdfLink.includes("arxiv.org/pdf/")&&(e[t].source="arxiv"),t.match(/^\d/)&&"arxiv"===e[t].source)){const r=`Arxiv-${t}`;let a={...e[t],id:r};e[r]=a,n.push(t)}if(a<209&&(info("Applying migration 0.2.9"),e[t].hasOwnProperty("favorite")||(e[t].favorite=!1,e[t].favoriteDate="")),a<210){if(info("Applying migration 0.2.10"),"arxiv"===e[t].source){const r=e[t].pdfLink.match(/v\d+\.pdf/gi);r&&r.length>0&&(e[t].pdfLink=e[t].pdfLink.replace(r[0],".pdf"))}e[t].hasOwnProperty("bibtext")&&(e[t].bibtex=e[t].bibtext+"",delete e[t].bibtext)}}return n.forEach((t,r)=>{delete e[t],console.log("Deleting "+t)}),s={...e},s.__dataVersion=t,r&&chrome.storage.local.set({papers:s},()=>{console.log("Migrated papers:"),console.log(s),console.log("Data version is now "+t)}),{papers:s,success:!0}}catch(e){return console.log(`Error migrating data from version ${a} to ${t}: `),console.log(e),{papers:s,success:!1,error:e}}},logStorage=e=>{chrome.storage.local.get(e,t=>{console.log(t[e])})},getStorage=e=>new Promise((t,r)=>{chrome.storage.local.get(e,r=>{t("string"==typeof e?r[e]:r)})}),setStorage=(e,t)=>new Promise((r,a)=>{chrome.storage.local.set({[e]:t},()=>{r(!0)})}),deletePaperInStorage=async e=>{const t=await getStorage("papers");let r=!1;t.hasOwnProperty(e)&&(r=delete t[e]),r?(setStorage("papers",t),console.log("Successfully deleted paper",e)):console.log("Error: no deletion")},getTheme=async()=>{const e=await getStorage("checkDarkMode");return e?"dark":"light"},backupData=async e=>{chrome.storage.local.get("papersBackup",({papersBackup:t})=>{void 0===t&&(t={});const r=Object.keys(t).map(e=>parseInt(e)).sort((e,t)=>e<t?1:-1).slice(4);for(const e of r)delete t[e];t[e.__dataVersion]=e,chrome.storage.local.set({papersBackup:t},()=>{console.log("Backed up data with version: "+e.__dataVersion)})})},statePdfTitle=(e,t)=>{let r;try{r=global.state.pdfTitleFn(e,t)}catch(a){console.log("statePdfTitle error",a),r=defaultPDFTitleFn(e,t)}return r.replaceAll("\n"," ").replace(/\s\s+/g," ")},getManifestDataVersion=()=>{const e=chrome.runtime.getManifest();return e.version.split(".").map((e,t)=>parseInt(e)*10**(4-2*t)).reduce((e,t)=>e+t)},versionToSemantic=e=>(major=parseInt(e/1e4,10),e-=1e4*major,minor=parseInt(e/100,10),e-=100*minor,`${major}.${minor}.${e}`),initState=async(e,t)=>{const r=Date.now();void 0===e&&(e=await getStorage("papers"),console.log("Time to retrieve stored papers (s): "+(Date.now()-r)/1e3)),global.state.dataVersion=getManifestDataVersion(),global.state.pdfTitleFn=defaultPDFTitleFn;const a=Date.now(),n=await migrateData(e,global.state.dataVersion);console.log("Migration duration (s): "+(Date.now()-a)/1e3),e=n.papers,global.state.papers=e,t?console.log("State initialization duration (s): "+(Date.now()-r)/1e3):(global.state.papersList=Object.values(cleanPapers(e)),global.state.sortKey="lastOpenDate",global.state.papersReady=!0,sortMemory(),makeTags(),console.log("State initialization duration (s): "+(Date.now()-r)/1e3))},hashCode=e=>e.split("").reduce((e,t)=>(e=(e<<5)-e+t.charCodeAt(0),e&e),0),parseCVFUrl=e=>{const t=e.replace("https://openaccess.thecvf.com/content","").slice(1).split("/")[0].split("_");let r,a;1===t.length?(r=t[0].slice(0,-4),a=t[0].slice(-4)):(r=t[0].toUpperCase(),a=t[1]);const n=e.split("/").reverse()[0].split(".")[0],o=(hashCode(n)+"").replace("-","").slice(0,8),s=`${r}-${a}_${o}`;return{conf:r,year:a,id:s}},isPaper=e=>{parseUrl(e);let t={};for(const r in global.knownPaperPages){const a=global.knownPaperPages[r];t[r]=!1;for(const n of a)e.includes(n)&&(t[r]=!0)}return t},cleanBiorxivURL=e=>(e=e.replace(".full.pdf",""),e.match(/\d$/)||(e=e.split(".").slice(0,-1).join(".")),e),parseIdFromUrl=e=>{const t=isPaper(e);if(t.arxiv){const t=e.match(/\d{4}\.\d{4,5}/g)[0];return`Arxiv-${t}`}if(t.neurips){const t=e.split("/paper/")[1].split("/")[0],r=e.split("/").reverse()[0].split("-")[0].slice(0,8);return`NeurIPS-${t}_${r}`}if(t.cvf)return parseCVFUrl(e).id;if(t.openreview){const t=e.match(/id=\w+/)[0].replace("id=",""),r=Object.values(cleanPapers(global.state.papers)).filter(e=>e.id.includes(t))[0];return r&&r.id}if(t.biorxiv){e=cleanBiorxivURL(e);let t=e.split("/").reverse()[0];return t.match(/v\d+$/)&&(t=t.split("v")[0]),`Biorxiv-${t}`}if(t.pmlr){const t=e.split("/").reverse()[0].split(".")[0],r="20"+t.match(/\d+/)[0];return`PMLR-${r}-${t}`}throw Error("unknown paper url")},paperToAbs=e=>{const t=e.pdfLink;let r="";switch(e.source){case"arxiv":r=`https://arxiv.org/abs/${e.id.split("-")[1]}`;break;case"neurips":r=t.replace("/file/","/hash/").replace("-Paper.pdf","-Abstract.html");break;case"cvf":r=t.replace("/papers/","/html/").replace(".pdf",".html");break;case"openreview":r=t.replace("/pdf?","/forum?");break;case"biorxiv":r=t.replace(".full.pdf","");break;case"pmlr":r=t.split("/").slice(0,-1).join("/")+".html";break;default:r="https://xkcd.com/1969/"}return r.replace("http://","https://")},paperToPDF=e=>{let t=e.pdfLink;switch(e.source){case"arxiv":t=`https://arxiv.org/pdf/${e.id.split("-")[1]}.pdf`;break;case"neurips":t=t.replace("/hash/","/file/").replace("-Abstract.html","-Paper.pdf");break;case"cvf":t=t.replace("/html/","/papers/").replace(".html",".pdf");break;case"openreview":t=t.replace("/forum?","/pdf?");break;case"biorxiv":t=cleanBiorxivURL(t)+".full.pdf";break;case"pmlr":break;default:t="https://xkcd.com/1969/"}return t.replace("http://","https://")},textareaFocusEnd=e=>{setTimeout(()=>{e.selectionStart=e.selectionEnd=1e4},0)},formatBibtext=e=>{let t=e.trim().split("\n").join("").replace(/\s+=/g," =");const r=t.match(/\ \w+\ ?=\ ?{/g)||[],a=t.match(/,\w+\ ?=\ ?{/g)||[];if(r&&r.length>0)for(const e of r)t=t.replace(e,`\n ${e}`);if(a&&a.length>0)for(const e of a){const r=e.replace(",","");t=t.replace(e,`,\n  ${r}`)}return"}}"===t.slice(-2)&&(t=t.slice(0,-1)+"\n}"),t.replaceAll("{ ","{").replaceAll(" }","}").replaceAll(" = ","=")},validatePaper=(e,t=!0)=>{const r={addDate:{type:"string",desc:"the paper's date of addition to the Memory",default:e=>(new Date).toJSON()},author:{type:"string",desc:"` and `-separated authors `${firstName} ${lastName}`"},bibtex:{type:"string",desc:"BibTex citation with new lines (`\n`)"},codeLink:{type:"string",desc:"the paper's code link",default:e=>""},count:{type:"number",desc:"the paper's number of visits",default:e=>1},favorite:{type:"boolean",desc:"user wants to star the paper",default:e=>!1},favoriteDate:{type:"string",desc:"date the paper was added as a favorite",default:e=>""},id:{type:"string",desc:"Unique PaperMemory ID"},key:{type:"string",desc:"BibTex citation key",default:e=>`defaultKey_${e.id}`},lastOpenDate:{type:"string",desc:"When the paper was last opened",default:e=>(new Date).toJSON()},md:{type:"string",desc:"markdown-formatted string `[${title}](${pdfLink})`",default:e=>`[${e.title}](${e.pdfLink})`},note:{type:"string",desc:"the user's note for this paper",default:e=>""},pdfLink:{type:"string",desc:"the link to the paper's pdf"},source:{type:"string",desc:"the paper's source i.e. where it was added to the memory from"},tags:{type:"array[string]",desc:"the user's tags for this paper",default:e=>[]},year:{type:"string",desc:"year of publication"}};let a=[];for(const n in r)if(e.hasOwnProperty(n)){const o=r[n].type,s=typeof e[n];if(o.startsWith("array")){const r=o.split("[")[1].replace("]","");if(Array.isArray(e[n])){if(e[n].length>0){const o=typeof e[n][0];o!==r&&(message=`➤ ${n} should contain ${r} not ${o} (${e.id})`,a.push(message),t&&console.warn(message))}}else message=`${n} should be an array (${e.id})`,a.push(message),t&&console.warn(message)}else s!==o&&(message=`➤ ${n} should be of type ${o} not ${s} (${e.id})`,a.push(message),t&&console.warn(message))}else{if(!r[n].default)throw Error(`Cannot continue, paper is corrupted. Missing mandatory attribute "${n}" in ${e.id}`);{const o=r[n].default(e);e[n]=o,message=`➤ Attribute "${n}" absent; will be set to "${o}" (${e.id})`,a.push(message),t&&console.warn(message)}}const n=Object.keys(global.knownPaperPages);return n.indexOf(e.source)<0&&(message=`Unknown source ${e.source} (${e.id})`,a.push(message),console.warn(message)),{warnings:a,paper:e}},tablerSvg=(e,t,r)=>{switch(void 0===t&&(t=""),void 0===r&&(r=[]),t&&(t=`id="${t}"`),r=r.filter(e=>e),r&&(r=`class="${r.join(" ")}"`),e){case"adjustments":return`<svg viewBox="0 0 24 24" ${t} ${r}>\n            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>\n            <circle cx="6" cy="10" r="2" />\n            <line x1="6" y1="4" x2="6" y2="8" />\n            <line x1="6" y1="12" x2="6" y2="20" />\n            <circle cx="12" cy="16" r="2" />\n            <line x1="12" y1="4" x2="12" y2="14" />\n            <line x1="12" y1="18" x2="12" y2="20" />\n            <circle cx="18" cy="7" r="2" />\n            <line x1="18" y1="4" x2="18" y2="5" />\n            <line x1="18" y1="9" x2="18" y2="20" />\n            </svg>`;case"circle-x":return`<svg viewBox="0 0 24 24" ${t} ${r}>\n            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>\n            <circle cx="12" cy="12" r="9" />\n            <path d="M10 10l4 4m0 -4l-4 4" />\n            </svg>`;case"star":return`<svg viewBox="0 0 24 24" ${t} ${r}>\n            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>\n            <path d="M12 17.75l-6.172 3.245l1.179 -6.873l-5 -4.867l6.9 -1l3.086 -6.253l3.086 6.253l6.9 1l-5 4.867l1.179 6.873z" />\n            </svg>`;case"writing":return`<svg viewBox="0 0 24 24" ${t} ${r}>\n            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>\n            <path d="M20 17v-12c0 -1.121 -.879 -2 -2 -2s-2 .879 -2 2v12l2 2l2 -2z" />\n            <path d="M16 7h4" />\n            <path d="M18 19h-13a2 2 0 1 1 0 -4h4a2 2 0 1 0 0 -4h-3" />\n            </svg>`;case"file-symlink":return`<svg viewBox="0 0 24 24" ${t} ${r}>\n            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>\n            <path d="M4 21v-4a3 3 0 0 1 3 -3h5" />\n            <path d="M9 17l3 -3l-3 -3" />\n            <path d="M14 3v4a1 1 0 0 0 1 1h4" />\n            <path d="M5 11v-6a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2h-9.5" />\n            </svg>`;case"link":return`<svg viewBox="0 0 24 24" ${t} ${r}>\n            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>\n            <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />\n            <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />\n            </svg>`;case"clipboard-list":return`<svg viewBox="0 0 24 24" ${t} ${r}>\n            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>\n            <path d="M9 5h-2a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-12a2 2 0 0 0 -2 -2h-2" />\n            <rect x="9" y="3" width="6" height="4" rx="2" />\n            <line x1="9" y1="12" x2="9.01" y2="12" />\n            <line x1="13" y1="12" x2="15" y2="12" />\n            <line x1="9" y1="16" x2="9.01" y2="16" />\n            <line x1="13" y1="16" x2="15" y2="16" />\n            </svg>`;case"archive":return`<svg viewBox="0 0 24 24" ${t} ${r}>\n            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>\n            <rect x="3" y="4" width="18" height="4" rx="2" />\n            <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />\n            <line x1="10" y1="12" x2="14" y2="12" />\n            </svg>`;case"external-link":return`<svg viewBox="0 0 24 24" ${t} ${r}>\n            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>\n            <path d="M11 7h-5a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-5" />\n            <line x1="10" y1="14" x2="20" y2="4" />\n            <polyline points="15 4 20 4 20 9" />\n            </svg>`;case"file-download":return`<svg viewBox="0 0 24 24" ${t} ${r}>\n            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>\n            <path d="M14 3v4a1 1 0 0 0 1 1h4" />\n            <path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" />\n            <line x1="12" y1="11" x2="12" y2="17" />\n            <polyline points="9 14 12 17 15 14" />\n             </svg>`;case"cirlce-x":return`<svg viewBox="0 0 24 24" ${t} ${r}>\n\t\t\t<path stroke="none" d="M0 0h24v24H0z" fill="none" />\n\t\t\t<circle cx="12" cy="12" r="9" />\n\t\t\t<path d="M10 10l4 4m0 -4l-4 4" />\n\t\t    </svg>`;case"settings":return`<svg viewBox="0 0 24 24" ${t} ${r}>\n            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>\n            <path d="M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z" />\n            <circle cx="12" cy="12" r="3" />\n            </svg>`;case"external-link":default:return""}},stringifyError=e=>{const t=chrome.runtime.id;return e.stack.split("\n").map(e=>e.split(" ").map(e=>e.split(t).reverse()[0]).join(" ")).join("<br/>")},overwriteMemory=async e=>{let t,r=!0,a="",n="";try{e.__dataVersion||(e.__dataVersion=1);const o=await migrateData(e,getManifestDataVersion(),!1);if(!o.success)return n="Could not migrate the data before storing it",o.error&&(n+=":<br/>"+stringifyError(o.error)),{success:!1,message:n};t=o.papers;for(const e in t)e.startsWith("__")||(paperWarnings=validatePaper(t[e]).warnings,paperWarnings&&paperWarnings.length>0&&(a+="<br/>"+paperWarnings.join("<br/>")));if(a){const e=await getStorage("papers");setStorage("uploadBackup",e)}r=!1}catch(e){console.log("overwriteMemory error",e),n='<h5 class="errorTitle"> /!\\ OverwriteMemoryError:</h5><br/>'+stringifyError(e),r=!0}return{success:!r,message:n,warning:a,papersToWrite:t}},arraysIdentical=(e,t)=>{var r=e.length;if(r!=t.length)return!1;for(;r--;)if(e[r]!==t[r])return!1;return!0},parseTags=e=>{let t=Array.from(e.selectedOptions,e=>e.value.trim()).filter(e=>e);return t.sort(),t},getPaperEdits=(e,t)=>{let r,a,n,o;return t?(r=val(`popup-form-note-textarea--${e}`),n=val(document.getElementById(`popup-form-note--${e}`).querySelector(".form-code-input")),a=parseTags(findEl(`popup-item-tags--${e}`)),o=findEl(`checkFavorite--${e}`).checked):(r=val(findEl(e,"form-note-textarea")),n=val(findEl(e,"form-code-input")),a=parseTags(findEl(e,"memory-item-tags")),o=hasClass(`memory-container--${e}`,"favorite")),{note:r,tags:a,codeLink:n,favorite:o}},setFormChangeListener=(e,t)=>{let r,a,n,o;t?(r=`#popup-item-tags--${e.replace(".","\\.")}`,n=`popup-form-codeLink--${e}`,a=`popup-form-note-textarea--${e}`,o=`checkFavorite--${e}`,$(r).on("change",monitorPaperEdits(e,t)),addListener(n,"keyup",monitorPaperEdits(e,t)),addListener(a,"keyup",monitorPaperEdits(e,t)),addListener(o,"change",monitorPaperEdits(e,t))):(r=".memory-item-tags",n=".form-code-input",a=".form-note-textarea",addEventToClass(n,"keyup",monitorPaperEdits(e,t)),addEventToClass(a,"keyup",monitorPaperEdits(e,t)))},monitorPaperEdits=(e,t)=>r=>{void 0===e&&(e=eventId(r));const a=getPaperEdits(e,t),n=global.state.papers[e];let o,s=!1,i={};for(const e in a){const t=n[e];i[e]=t;const r=a[e];"tags"!==e||arraysIdentical(t,r)?"tags"!==e&&t!==r&&(s=!0):s=!0}o=t?findEl(`popup-save-edits--${e}`):findEl(e,"memory-item-save-edits"),disable(o,!s)},cutAuthors=(e,t,r)=>{void 0===t&&(t=140),void 0===r&&(r=", ");let a="";const n=e.split(" and "),o=n[n.length-1];for(const e of n){if(!(5+a.length+r.length+e.length+o.length<t)){a+=" ... "+o;break}a?a+=", "+e:a=e}return a},findEl=(e,t)=>void 0===t?"string"==typeof e?document.getElementById(e):e:findEl(`memory-container--${e}`).querySelector(`.${t}`),fadeOut=(e,t=250,r=(()=>{}))=>{e=findEl(e),e.style.transition=`${t}ms`,e.style.opacity=0,setTimeout(()=>{e.style.display="none",r()},t)},fadeIn=(e,t="block",r=250,a=(()=>{}))=>{e=findEl(e),e.style.opacity=0,"none"===e.style.display&&(e.style.display=t),setTimeout(()=>{e.style.transition=`${r}ms`,e.style.opacity=1,setTimeout(()=>{a()},r)},0)},val=(e,t)=>{if(e instanceof HTMLInputElement&&"checkbox"===e.type){if(void 0===t)return e.checked;e.checked=t}if("string"==typeof e&&(e=findEl(e)),void 0===t)return e?e.value:"";e&&(e.value=t)},showId=(e,t="block")=>{let r=findEl(e);r&&(r.style.display=t)},hideId=e=>{el=findEl(e),el&&(el.style.display="none")},setTextId=(e,t)=>{let r=findEl(e);r&&(r.innerText=t)},setHTML=(e,t)=>{"string"==typeof e&&(e=findEl(e)),e&&(e.innerHTML=t)},dispatch=(e,t)=>{if("string"==typeof e&&(e=findEl(e)),"string"==typeof t){if("focus"===t)return void e.focus();if("blur"===t)return void e.blur();t=new Event(t)}e&&e.dispatchEvent(t)},hasClass=(e,t)=>{let r;if(r="string"==typeof e?findEl(e):e,r)return r.classList.contains(t)},addClass=(e,t)=>{let r;r="string"==typeof e?findEl(e):e,r&&r.classList.add(t)},removeClass=(e,t)=>{let r;r="string"==typeof e?findEl(e):e,r&&r.classList.remove(t)},addListener=(e,t,r)=>{"string"==typeof e&&(e=findEl(e)),e&&e.addEventListener(t,r)},setPlaceholder=(e,t)=>{"string"==typeof e&&(e=findEl(e)),e&&void 0!==e.placeholder&&(e.placeholder=t)},style=(e,t,r)=>{if("string"==typeof e&&(e=findEl(e)),e){if(void 0===r)return e.style[t];e.style[t]=r}},disable=(e,t=!0)=>{"string"==typeof e&&(e=findEl(e)),e&&(e.disabled=t)},slideUp=(e,t=250,r=(()=>{}))=>{"string"==typeof e&&(e=findEl(e)),e&&(e.style.transitionProperty="height, margin, padding",e.style.transitionDuration=t+"ms",e.style.height=e.offsetHeight+"px",e.offsetHeight,e.style.overflow="hidden",e.style.height=0,e.style.paddingTop=0,e.style.paddingBottom=0,e.style.marginTop=0,e.style.marginBottom=0,window.setTimeout(()=>{e.style.display="none",e.style.removeProperty("height"),e.style.removeProperty("padding-top"),e.style.removeProperty("padding-bottom"),e.style.removeProperty("margin-top"),e.style.removeProperty("margin-bottom"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property"),e.style.removeProperty("box-sizing"),r()},t))},slideDown=(e,t=500,r=(()=>{}))=>{if("string"==typeof e&&(e=findEl(e)),!e)return;e.style.removeProperty("display");let a=window.getComputedStyle(e).display;"none"===a&&(a="block"),e.style.display=a;let n=e.offsetHeight;e.style.overflow="hidden",e.style.height=0,e.style.paddingTop=0,e.style.paddingBottom=0,e.style.marginTop=0,e.style.marginBottom=0,e.offsetHeight,e.style.transitionProperty="height, margin, padding",e.style.transitionDuration=t+"ms",e.style.height=n+"px",e.style.removeProperty("padding-top"),e.style.removeProperty("padding-bottom"),e.style.removeProperty("margin-top"),e.style.removeProperty("margin-bottom"),window.setTimeout(()=>{e.style.removeProperty("height"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property"),r()},t)},slideToggle=(e,t=500,r=(()=>{}))=>"none"===window.getComputedStyle(e).display?slideDown(e,t,r):slideUp(e,t,r),extractBibtexValue=(e,t)=>{const r=new RegExp(`${t}\\s?=\\s?{(.+)},`,"gi");console.log(r);const a=r.exec(e);if(a){const e=new RegExp(`${t}\\s?=\\s?{`,"gi");return a[0].replace(e,"").slice(0,-2)}return""},extractAuthor=e=>extractBibtexValue(e,"author").replaceAll("{","").replaceAll("}","").replaceAll("\\","").split(" and ").map(e=>e.split(", ").reverse().join(" ")).join(" and "),fetchArxivXML=async e=>{const t=e.replace("Arxiv-","");return $.get("https://export.arxiv.org/api/query",{id_list:t})},fetchNeuripsHTML=async e=>{let t;return t=e.endsWith(".pdf")?e.replace("/file/","/hash/").replace("-Paper.pdf","-Abstract.html"):e,fetch(t).then(e=>e.text())},fetchCvfHTML=async e=>{let t,r;if(t=e.endsWith(".pdf")?e.replace("/papers_backup/","/papers/").replace("/papers/","/html/").replace(".pdf",".html"):e,r=await fetch(t).then(e=>e.ok?e.text():""),!r&&t.includes("thecvf.com/content_")){const{conf:a,year:n}=parseCVFUrl(e);t=t.replace(`/content_${a}_${n}/`,`/content_${a.toLowerCase()}_${n}/`),r=await fetch(t).then(e=>e.ok?e.text():"")}return r},fetchOpenReviewNoteJSON=async e=>{const t=e.match(/id=\w+/)[0].replace("id=",""),r=`https://api.openreview.net/notes?id=${t}`;return fetch(r).then(e=>e.json())},fetchOpenReviewForumJSON=async e=>{const t=e.match(/id=\w+/)[0].replace("id=",""),r=`https://api.openreview.net/notes?forum=${t}`;return fetch(r).then(e=>e.json())},parseArxivBibtex=async e=>{let t;t="undefined"==typeof data?await fetchArxivXML(e):data;var r=$(t),a=[],n="";r.find("author name").each((e,t)=>{a.push($(t).text()),0===e&&(n+=$(t).text().split(" ")[$(t).text().split(" ").length-1].toLowerCase())});var o="";r.find("link").each((e,t)=>{const r=$(t).attr("href");r&&r.indexOf("arxiv.org/pdf/")>=0&&(o=r)});const s=o.match(/v\d+\.pdf/gi);s&&s.length>0&&(o=o.replace(s[0],".pdf"));const i=a.join(" and "),l=$(r.find("entry title")[0]).text(),c=$(r.find("entry published")[0]).text().slice(0,4);n+=c,n+=firstNonStopLowercase(l);const p=e,d="arXiv";let h="";return h+=`@article{${n},\n`,h+=`    title={${l} },\n`,h+=`    author={${i} },\n`,h+=`    year={${c}},\n`,h+=`    journal={arXiv preprint arXiv: ${p}}\n`,h+="}",{author:i,bibtex:h,conf:d,id:p,key:n,pdfLink:o,title:l,year:c}},parseNeuripsHTML=async e=>{const t=await fetchNeuripsHTML(e),r=(new DOMParser).parseFromString(t.replaceAll("\n",""),"text/html"),a=$(r),n=a.find(".container-fluid .col p"),o=e.split("/").slice(-1)[0].replace("-Paper.pdf",""),s=a.find("h4").first().text(),i=$(n[1]).text().split(", ").map((e,t)=>{const r=e.split(" "),a=r.map((e,t)=>capitalize(e));return a.join(" ")}).join(" and "),l=e,c=$(n[0]).text().match(/\d{4}/)[0],p=`neurips${c}${o.slice(0,8)}`,d=`NeurIPS-${c}_${o.slice(0,8)}`,h=`NeurIPS ${c}`,f=`Accepted @ ${h}`;let u="";return u+=`@inproceedings{NEURIPS${c}_${o.slice(0,8)},\n`,u+=`    author={${i}},\n`,u+="    booktitle={Advances in Neural Information Processing Systems},\n",u+="    editor={H.Larochelle and M.Ranzato and R.Hadsell and M.F.Balcan and H.Lin},\n",u+="    publisher={Curran Associates, Inc.},\n",u+=`    title={${s}},\n`,u+=`    url={${e}},\n`,u+=`    year={${c}}\n`,u+="}",{author:i,bibtex:u,conf:h,id:d,key:p,note:f,pdfLink:l,title:s,year:c}},parseCvfHTML=async e=>{const t=await fetchCvfHTML(e),r=(new DOMParser).parseFromString(t.replaceAll("\n",""),"text/html"),a=$(r),n=a.find("#papertitle").text().trim();let o=a.find("#authors i").first().text();o=o.split(",").map(e=>e.trim()).join(" and ");const{year:s,id:i,conf:l}=parseCVFUrl(e);let c="";e.endsWith(".pdf")?c=e:a.find("a").each((e,t)=>{if("pdf"===$(t).text()){let e=$(t).attr("href");e.startsWith("../")&&(e=e.replaceAll("../","")),e.startsWith("/")||(e="/"+e),c="http://openaccess.thecvf.com"+e}});const p=`Accepted @ ${l} ${s}`,d=a.find(".bibref").first().text(),h=d.split("{")[1].split(",")[0];return{author:o,bibtex:d,conf:l,id:i,key:h,note:p,pdfLink:c,title:n,year:s}};makeOpenReviewBibTex=((e,t)=>{const r=e.content.title,a=e.content.authors.join(" and "),n=e.cdate?new Date(e.cdate).getFullYear():"0000";e.cdate||console.log("makeOpenReviewBibTex: no cdate found in",e);let o=e.content.authors[0].split(" ").reverse()[0];o+=n,o+=firstNonStopLowercase(r);let s="";return s+=`@inproceedings{${o},\n`,s+=`    title={${r}},\n`,s+=`    author={${a}},\n`,s+=`    year={${n}},\n`,s+=`    url={${t}},\n`,s+="}",s});const parseOpenReviewJSON=async e=>{
const t=await fetchOpenReviewNoteJSON(e),r=await fetchOpenReviewForumJSON(e);var a=t.notes[0];console.log("paper: ",a);var n=r.notes;console.log("forum: ",n);const o=a.content.title,s=a.content.authors.join(" and "),i=a.content._bibtex||makeOpenReviewBibTex(a,e),l=i.split("{")[1].split(",")[0].trim(),c=i.split("year={")[1].split("}")[0];let p;p=a.pdf?`https://openreview.net/pdf?id=${a.id}`:a.html?a.html.replace("/forum?id=","/pdf?id="):e.replace("/forum?id=","/pdf?id=");const d=a.invitation.split("/");let h=d[0].split(".")[0],f=d.slice(1).join("/").split("-")[0].replaceAll("/"," ").replace(" Conference",""),u=h,g=!1;global.overrideORConfs.hasOwnProperty(h)&&(u=global.overrideORConfs[h],g=!0),g&&(f=f.replace(u,""),h=u);const m=`${h} ${f}`.replace(/ \d\d\d\d/g,"").replace(/\s\s+/g," "),y=`OR-${h}-${c}_${a.id}`;let v,w,b;return v=n.filter(e=>e&&e.content&&["Final Decision","Paper Decision","Acceptance Decision"].indexOf(e.content.title)>-1),console.log("forum: ",n),v&&v.length>0&&(w=v[0].content.decision.split(" ").map((e,t)=>0===t?e+"ed":e).join(" "),b=`${w} @ ${m} ${c}`),"Anonymous"===s&&(b=`Under review @ ${m} ${c} (${(new Date).toLocaleDateString()})`),{author:s,bibtex:i,conf:m,id:y,key:l,note:b,pdfLink:p,title:o,year:c}},parseBiorxivJSON=async e=>{const t="https://api.biorxiv.org/",r=e.replace(".full.pdf",""),a=e.split("/").slice(-2).join("/").replace(".full.pdf","").split("v")[0],n=`${t}/details/biorxiv/${a}`,o=await fetch(n).then(e=>e.json());if("ok"!==o.messages[0].status)throw new Error(`${n} returned ${o.messages[0].status}`);const s=o.collection.reverse()[0],i=await fetch(r),l=await i.text(),c=(new DOMParser).parseFromString(l.replaceAll("\n",""),"text/html"),p=c.querySelector(".bibtext a").href,d=await(await fetch(p)).text(),h=extractAuthor(d),f="BioRxiv",u=parseIdFromUrl(e),g=d.split("\n")[0].split("{")[1].replace(",","").trim(),m="",y=cleanBiorxivURL(e)+".full.pdf",v=s.title,w=s.date.split("-")[0];return{author:h,bibtex:d,conf:f,id:u,key:g,note:m,pdfLink:y,title:v,year:w}},parsePMLRHTML=async e=>{const t=e.split("/").reverse()[0].split(".")[0],r=parseIdFromUrl(e),a=e.includes(".html")?e:e.split("/").slice(0,-2).join("/")+`${t}.html`,n=a.replace(".html","")+`/${t}.pdf`,o=(new DOMParser).parseFromString((await(await fetch(a)).text()).replaceAll("\n",""),"text/html"),s=(o.getElementById("button-bibtex1").getAttribute("onclick").match(/https.+\.bib/)[0],o.getElementById("bibtex").innerText.replaceAll("\t"," ").replaceAll(/\s\s+/g," "));let i=s;const l=s.match(/,\ ?\w+ ?= ?{/g);for(const e of l)i=i.replace(e,e.replace(", ",",\n    ").replace(" = ","="));i.endsWith("}}")&&(i=i.slice(0,-2)+"}\n}");const c=extractAuthor(i),p=o.getElementsByTagName("h1")[0].innerText,d=extractBibtexValue(i,"year");let h=extractBibtexValue(i,"booktitle").replaceAll("Proceedings of the","");note="Accepted @ "+h+` (${d})`;for(const e in global.overridePMLRConfs)if(h.includes(e)){h=global.overridePMLRConfs[e]+" "+d,note="Accepted @ "+h;break}return{author:c,bibtex:i,conf:h,id:r,key:t,note:note,pdfLink:n,title:p,year:d}},fetchOpts={headers:{mode:"no-cors"}},fetchPWCId=async(e,t)=>{let r="https://paperswithcode.com/api/v1/papers/?";e?r+=new URLSearchParams({arxiv_id:e}):t&&(r+=new URLSearchParams({title:t}));const a=await $.getJSON(r);if(console.log({json:a}),1===a.count)return a.results[0].id},fetchCodes=async e=>{let t,r;(e.source="neurips")?r=e.title:t=e.id;const a=await fetchPWCId(t,r);if(!a)return[];let n=`https://paperswithcode.com/api/v1/papers/${a}/repositories/?`;n+=new URLSearchParams({page:1,items_per_page:10});const o=await fetch(n),s=await o.json();if(s.count<1)return;let i=s.results;return i.sort((e,t)=>e.stars-t.stars),i.slice(0,5)},initPaper=e=>{e.note||(e.note=""),e.md=`[${e.title}](${e.pdfLink})`,e.tags=[],e.codeLink="",e.favorite=!1,e.favoriteDate="",e.addDate=(new Date).toJSON(),e.lastOpenDate=e.addDate,e.count=1;for(const t in e)e.hasOwnProperty(t)&&"string"==typeof e[t]&&(e[t]=e[t].trim());return validatePaper(e),e},makePaper=async(e,t,r)=>{let a;if(e.arxiv)a=await parseArxivBibtex(r),a.source="arxiv";else if(e.neurips)a=await parseNeuripsHTML(t),a.source="neurips";else if(e.cvf)a=await parseCvfHTML(t),a.source="cvf";else if(e.openreview)a=await parseOpenReviewJSON(t),a.source="openreview";else if(e.biorxiv)a=await parseBiorxivJSON(t),a.source="biorxiv";else{if(!e.pmlr)throw Error("Unknown paper source: "+JSON.stringify({is:e,url:t,id:r}));a=await parsePMLRHTML(t),a.source="pmlr"}return initPaper(a)},addOrUpdatePaper=async(e,t,r)=>{let a,n;const o=parseIdFromUrl(e);return console.log("id: ",o),o&&global.state.papers.hasOwnProperty(o)?(global.state.papers=updatePaper(global.state.papers,o),a=global.state.papers[o],n=!1):(a=await makePaper(t,e,o),global.state.papers[a.id]=a,n=!0),chrome.storage.local.set({papers:global.state.papers},()=>{n?(console.log("Added '"+a.title+"' to your Memory"),console.log("paper: ",a),r&&r.checkFeedback&&feedback("Added to your Memory!",a)):console.log("Updated '"+a.title+"' in your Memory")}),{paper:a,id:o}};