const findEl=(e,t)=>$(`#memory-item-container--${e}`).find(`.${t}`).first(),getTagsHTMLOptions=e=>{const t=new Set(e.tags);return Array.from(_state.paperTags).sort().map((e,o)=>{let s=`<option value="${e}"`;return t.has(e)&&(s+=' selected="selected" '),s+`>${e}</option>`}).join("")},updatePopupPaperNoMemory=()=>{$("#isArxiv").html('\n        <div style="font-size: 1.5rem;">This paper is not in your memory</div>\n        <h4> Refresh the page to add it back </h4>\n    ')},confirmDelete=e=>{const t=_state.papers[e].title;$("body").append(`\n    <div id="confirm-modal">\n        <div style="width: 80%; padding: 32px 32px; text-align: center; font-size: 1.1rem;">\n            Are you sure you want to delete:<p>${t}</p>?\n        </div>\n        <div style="width: 100%; text-align: center; padding: 32px;">\n            <button style="padding: 8px 16px;" id="cancel-modal-button">Cancel</button>\n            <span style="min-width: 32px;"></span>\n            <button style="padding: 8px 16px;" id="confirm-modal-button">Confirm</button>\n        </div>\n    </div>`),$("#cancel-modal-button").on("click",()=>{$("#confirm-modal").remove()}),$("#confirm-modal-button").on("click",()=>{delete _state.papers[e],chrome.storage.local.set({papers:_state.papers},()=>{_state.papersList=Object.values(cleanPapers(_state.papers)),sortMemory(),displayMemoryTable(),$("#confirm-modal").remove(),console.log("Successfully deleted '"+t+"' from ArxivMemory"),_state.currentId===e&&updatePopupPaperNoMemory()})})},copyAndConfirmMemoryItem=(e,t,o,s)=>{copyTextToClipboard(t);const n=e.replace(".","\\."),a=s?$("#popup-feedback-copied"):findEl(n,"memory-item-feedback");a.text(o),a.fadeIn(),setTimeout(()=>{a.fadeOut()},1e3)},focusExistingOrCreateNewCodeTab=e=>{const{origin:t}=new URL(e);chrome.tabs.query({url:`${t}/*`},t=>{for(const o of t)if(o.url.includes(e)){const e={active:!0},t={focused:!0};return void chrome.windows.getCurrent(s=>{s.id!==o.windowId?chrome.windows.update(o.windowId,t,()=>{chrome.tabs.update(o.id,e)}):chrome.tabs.update(o.id,e)})}chrome.tabs.create({url:e})})},focusExistingOrCreateNewPaperTab=e=>{const t=parseUrl(e.pdfLink).hostname;let o=e.pdfLink.split("/").reverse()[0].replace("-Paper.pdf","").replace(".pdf","");o.match(/\d{5}v\d+$/)&&"arxiv"===e.source&&(o=o.split("v")[0]),chrome.tabs.query({url:`*://${t}/*`},t=>{let s=[],n=[];const a=t.map(e=>e.url);let r=0;for(const e of a)e.indexOf(o)>=0&&(s.push(r),e.endsWith(".pdf")&&n.push(r)),r+=1;if(s.length>0){let e;e=n.length>0?t[n[0]]:t[s[0]];const o={active:!0},a={focused:!0};chrome.windows.getCurrent(t=>{t.id!==e.windowId?chrome.windows.update(e.windowId,a,()=>{chrome.tabs.update(e.id,o)}):chrome.tabs.update(e.id,o)})}else chrome.tabs.create({url:e.pdfLink});_state.papers[e.id].count+=1,chrome.storage.local.set({papers:_state.papers})})},saveNote=(e,t)=>{t=$.trim(t),_state.papers[e].note=t;const o=e.replace(".","\\.");chrome.storage.local.set({papers:_state.papers},()=>{console.log("Updated the note for "+_state.papers[e].title),findEl(o,"memory-note-div").html(t?`\n        <div class="memory-note-div memory-item-faded">\n            <span class="note-content-header">Note:</span>\n            <span class="note-content">${t}</span>\n        </div>`:'<div class="memory-note-div memory-item-faded"></div>'),$(`#popup-form-note-textarea--${o}`).val(t),findEl(o,"form-note-textarea").val(t)})},saveCodeLink=(e,t)=>{t=$.trim(t),_state.papers[e].codeLink=t;const o=e.replace(".","\\.");chrome.storage.local.set({papers:_state.papers},()=>{console.log(`Updated the code for ${_state.papers[e].title} to ${t}`),findEl(o,"memory-item-code-link").html(t),$("#popup-code-link").text(t),findEl(o,"form-code-input").val(t),t?$("#popup-code-link").show():$("#popup-code-link").hide()})},saveFavoriteItem=(e,t)=>{_state.papers[e].favorite=t,_state.papers[e].favoriteDate=(new Date).toJSON();const o=e.replace(".","\\.");chrome.storage.local.set({papers:_state.papers},()=>{if(console.log(`${_state.papers[e].title} is favorite: ${t}`),t?($(`#memory-item-container--${o}`).addClass("favorite"),findEl(o,"memory-item-favorite").find("svg").first().addClass("favorite")):($(`#memory-item-container--${o}`).removeClass("favorite"),findEl(o,"memory-item-favorite").find("svg").first().removeClass("favorite")),"favoriteDate"===_state.sortKey){t||(sortMemory(),displayMemoryTable());const e=_state.sortedPapers.filter(e=>e.favorite).length;$("#memory-search").prop("placeholder",`Search ${e} entries`)}$(`#checkFavorite--${o}`).prop("checked",t)})},setMemorySortArrow=e=>{let t;t="up"===e?'<svg class="memory-sort-arrow-svg" id="memory-sort-arrow-up">\n                    <use xlink:href="../../icons/tabler-sprite-nostroke.svg#tabler-arrow-narrow-up" />\n                </svg>':'<svg class="memory-sort-arrow-svg" id="memory-sort-arrow-down">\n                    <use xlink:href="../../icons/tabler-sprite-nostroke.svg#tabler-arrow-narrow-down" />\n                </svg>',$("#memory-sort-arrow").html(t)},orderPapers=(e,t)=>{let o=e[_state.sortKey],s=t[_state.sortKey];return void 0===o&&(o=""),void 0===s&&(s=""),"string"==typeof o&&(o=o.toLowerCase(),s=s.toLowerCase()),_descendingSortKeys.indexOf(_state.sortKey)>=0?o>s?-1:1:o>s?1:-1},sortMemory=()=>{_state.sortedPapers=Object.values(cleanPapers(_state.papers)),_state.sortedPapers.sort(orderPapers),_state.papersList.sort(orderPapers)},reverseMemory=()=>{_state.sortedPapers.reverse(),_state.papersList.reverse()},filterMemoryByString=e=>{const t=e.split(" ");let o=[];for(const e of _state.sortedPapers){const s=e.title.toLowerCase(),n=e.author.toLowerCase(),a=e.note.toLowerCase();t.every(e=>s.includes(e)||n.includes(e)||a.includes(e))&&(_state.showFavorites&&!e.favorite||o.push(e))}_state.papersList=o},filterMemoryByTags=e=>{const t=e.replace("t:","").toLowerCase().split(" ");let o=[];for(const e of _state.sortedPapers){const s=e.tags.map(e=>e.toLowerCase());t.every(e=>s.some(t=>t.indexOf(e)>=0))&&(_state.showFavorites&&!e.favorite||o.push(e))}_state.papersList=o},filterMemoryByCode=e=>{const t=e.replace("c:","").toLowerCase().split(" ");let o=[];for(const e of _state.sortedPapers){let s=e.codeLink||"";s=s.toLowerCase(),t.every(e=>s.includes(e))&&(_state.showFavorites&&!e.favorite||o.push(e))}_state.papersList=o},updatePaperTagsHTML=e=>{const t=e.replace(".","\\.");findEl(t,"tag-list").html(_state.papers[e].tags.map(e=>`<span class="memory-tag">${e}</span>`).join(""))},updateTagOptions=e=>{const t=e.replace(".","\\."),o=getTagsHTMLOptions(e);findEl(t,"memory-item-tags").html(o),$(`#popup-item-tags--${t}`).html(o)},updatePaperTags=(e,t)=>{let o;if(t.startsWith("#"))o=$(t);else{const s=e.replace(".","\\.");o=findEl(s,t)}let s=[];o.find(":selected").each((e,t)=>{const o=$.trim($(t).val());""!==o&&s.push(o)}),s.sort(),updated=!1,_state.papers[e].tags!==s&&(updated=!0),_state.papers[e].tags=s,console.log("Update tags to: "+s.join(", ")),updated&&chrome.storage.local.set({papers:_state.papers},()=>{updateTagOptions(e),updatePaperTagsHTML(e),makeTags()})},makeTags=()=>{let e=new Set;for(const t of _state.sortedPapers)for(const o of t.tags)e.add(o);_state.paperTags=Array.from(e),_state.paperTags.sort()},displayMemoryTable=()=>{const e=Date.now();var t=document.getElementById("memory-table");t.innerHTML="";for(const e of _state.papersList)try{t.insertAdjacentHTML("beforeend",getMemoryItemHTML(e))}catch(t){console.log(t),console.log(e)}const o=Date.now();console.log("Rendering duration (s): "+(o-e)/1e3),$(".back-to-focus").on("click",e=>{const{id:t,eid:o}=eventId(e);setTimeout(()=>{$(`#memory-item-container--${o}`).trigger("focus")},250)}),$(".delete-memory-item").on("click",e=>{const{id:t,eid:o}=eventId(e);confirmDelete(t)}),$(".memory-item-link").on("click",e=>{const{id:t,eid:o}=eventId(e);focusExistingOrCreateNewPaperTab(_state.papers[t])}),$(".memory-item-code-link").on("click",e=>{const{id:t,eid:o}=eventId(e),s=_state.papers[t].codeLink;focusExistingOrCreateNewCodeTab(s)}),$(".memory-item-md").on("click",e=>{const{id:t,eid:o}=eventId(e),s=_state.papers[t].md;copyAndConfirmMemoryItem(t,s,"Markdown link copied!")}),$(".memory-item-bibtext").on("click",e=>{const{id:t,eid:o}=eventId(e),s=_state.papers[t].bibtext;copyAndConfirmMemoryItem(t,s,"Bibtex copied!")}),$(".memory-item-copy-link").on("click",e=>{const{id:t,eid:o}=eventId(e),s=_state.papers[t].pdfLink;copyAndConfirmMemoryItem(t,s,"Pdf link copied!")}),$(".memory-item-favorite").on("click",e=>{const{id:t,eid:o}=eventId(e),s=$(`#memory-item-container--${o}`).hasClass("favorite");saveFavoriteItem(t,!s)}),$(".form-note-textarea").focus(function(){var e=this;textareaFocusEnd(e)}),$(".form-note").on("submit",e=>{e.preventDefault();const{id:t,eid:o}=eventId(e),s=findEl(o,"form-note-textarea").val(),n=findEl(o,"form-code-input").val();saveNote(t,s),saveCodeLink(t,n),updatePaperTags(t,"memory-item-tags"),findEl(o,"memory-item-edit").trigger("click")}),$(".cancel-note-form").on("click",e=>{e.preventDefault();const{id:t,eid:o}=eventId(e);findEl(o,"form-note-textarea").val(_state.papers[t].note),findEl(o,"memory-item-tags").html(getTagsHTMLOptions(t)),findEl(o,"memory-item-edit").trigger("click")}),$(".memory-item-edit").on("click",e=>{e.preventDefault();const{id:t,eid:o}=eventId(e),s=findEl(o,"memory-item-edit"),n=findEl(o,"code-and-note"),a=findEl(o,"extended-item"),r=findEl(o,"tag-list"),i=findEl(o,"edit-tags"),l=findEl(o,"memory-item-tags"),p=findEl(o,"memory-item-actions");s.hasClass("expand-open")?(s.removeClass("expand-open"),n.slideDown(250),r.slideDown(250),p.slideDown(250),a.slideUp(250),i.slideUp(250)):(s.addClass("expand-open"),l.select2({..._select2Options,width:"75%"}),n.slideUp(250),r.slideUp(250),p.slideUp(250),a.slideDown(250),i.slideDown(250))});const s=Date.now();console.log("Listeners duration (s): "+(s-o)/1e3)},openMemory=()=>{var e=Date.now();_state.menuIsOpen&&closeMenu(),_state.memoryIsOpen=!0,chrome.storage.local.get("papers",async function({papers:t}){await initState(t),$("#memory-search").attr("placeholder",`Search ${_state.papersList.length} entries ...`),$("#memory-container").slideDown({duration:200,easing:"easeOutQuint",complete:()=>{$("#memory-search").trigger("focus"),displayMemoryTable(),console.log("Time to display (s): "+(Date.now()-e)/1e3)}}),_state.papersList.length<20?delayTime=0:_state.papersList.length<50&&(delayTime=300),$("#memory-search").on("keypress",delay(e=>{const t=$.trim($(e.target).val());(t||"Backspace"===e.key)&&(t.startsWith("t:")?filterMemoryByTags(t):t.startsWith("c:")?filterMemoryByCode(t):filterMemoryByString(t),displayMemoryTable())},delayTime)).on("keyup",e=>{if("Backspace"==e.key){var t=$.Event("keypress");t.key="Backspace",$("#memory-search").trigger(t)}})}),$("#tabler-menu").fadeOut(),$("#memory-select").val("lastOpenDate"),setMemorySortArrow("down"),$("#memory-switch-text-on").fadeOut(()=>{$("#memory-switch-text-off").fadeIn()}),$("#filter-favorites").on("click",()=>{const e=!_state.showFavorites;if(_state.showFavorites=e,e){$("#filter-favorites").find("svg").first().addClass("favorite"),sortMemory(),_state.papersList=_state.papersList.filter(e=>e.favorite),displayMemoryTable(),setMemorySortArrow("down"),$("#memory-select").append('<option value="favoriteDate">Last favoured</option>');const e=_state.papersList.length;$("#memory-search").prop("placeholder",`Search ${e} entries...`)}else{$("#filter-favorites").find("svg").first().removeClass("favorite"),"favoriteDate"===$("#memory-select").val()&&($("#memory-select").val("lastOpenDate"),_state.sortKey="lastOpenDate"),$('#memory-select option[value="favoriteDate"]').remove(),sortMemory(),setMemorySortArrow("down"),$.trim($("#memory-search").val())?$("#memory-search").trigger("keypress"):(_state.papersList=_state.sortedPapers,displayMemoryTable());const e=_state.sortedPapers.length;$("#memory-search").prop("placeholder",`Search ${e} entries...`)}}),$("#memory-select").on("change",e=>{const t=$(e.target).val();_state.sortKey=t,sortMemory(),displayMemoryTable(),setMemorySortArrow("down")}),$("#memory-sort-arrow").on("click",e=>{"memory-sort-arrow-down"===$("#memory-sort-arrow svg").first()[0].id?setMemorySortArrow("up"):setMemorySortArrow("down"),reverseMemory(),displayMemoryTable()})},closeMemory=()=>{$("#memory-container").slideUp({duration:300,easing:"easeOutQuint"}),$("#memory-switch-text-off").fadeOut(()=>{$("#memory-switch-text-on").fadeIn()}),$("#tabler-menu").fadeIn(),$("#memory-search").val(""),_state.memoryIsOpen=!1},closeMenu=()=>{$("#menuDiv").slideUp({duration:300,easing:"easeOutQuint"})&&$("#tabler-menu").fadeOut(()=>{$("#tabler-menu").html('\n                <svg class="tabler-icon">\n                    <use xlink:href="../../icons/tabler-sprite-nostroke.svg#tabler-adjustments" />\n                </svg>\n            '),$("#tabler-menu").fadeIn()}),_state.menuIsOpen=!1},openMenu=()=>{$("#menuDiv").slideDown({duration:300,easing:"easeOutQuint"})&&$("#tabler-menu").fadeOut(()=>{$("#tabler-menu").html('\n            <svg class="tabler-icon menu-svg">\n                <use xlink:href="../../icons/tabler-sprite-nostroke.svg#tabler-circle-x" />\n            </svg>'),$("#tabler-menu").fadeIn()}),_state.menuIsOpen=!0},getAndTrackPopupMenuChecks=(e,t)=>{let o={};for(const s of t)o[s]=!e.hasOwnProperty(s)||e[s],$("#"+s).prop("checked",o[s]);chrome.storage.local.set(o);for(const e of t)$("#"+e).on("change",()=>{const t=$("#"+e).prop("checked");chrome.storage.local.set({[e]:t},function(){console.log(`Settings saved for ${e} (${t})`)})})},setStandardPopupClicks=()=>{$("#helpGithubLink").on("click",()=>{chrome.tabs.create({url:"https://github.com/vict0rsch/ArxivMemory"})}),$("#keyboardShortcuts").on("click",()=>{chrome.tabs.create({url:"https://github.com/vict0rsch/ArxivTools#keyboard-navigation"})}),$("#tabler-menu").on("click",()=>{_state.menuIsOpen?closeMenu():openMenu()}),$("#memory-switch").on("click",()=>{_state.memoryIsOpen?closeMemory():openMemory()}),$("#download-arxivmemory").on("click",()=>{const e=(new Date).toLocaleString();chrome.storage.local.get("papers",({papers:t})=>{const o=t.__dataVersion;downloadTextFile(JSON.stringify(t),`arxiv-memory-${o}-${e}.json`,"text/json")})})},setAndHandleCustomPDFFunction=menu=>{menu.pdfTitleFn&&"string"==typeof menu.pdfTitleFn&&(_state.pdfTitleFn=getPdfFn(menu.pdfTitleFn)),chrome.storage.local.set({pdfTitleFn:_state.pdfTitleFn.toString()}),$("#customPdfTitleTextarea").val(_state.pdfTitleFn.toString()),$("#saveCustomPdf").on("click",()=>{const code=$.trim($("#customPdfTitleTextarea").val());try{const fn=eval(code),tested=fn("test","1.2");if("string"!=typeof tested)throw Error("Custom function returns the wrong type:",typeof tested,tested);$("#customPdfFeedback").html('<span style="color: green">Saved!</span>'),chrome.storage.local.set({pdfTitleFn:code}),_state.pdfTitleFn=fn,setTimeout(()=>{$("#customPdfFeedback").html("")},1e3)}catch(e){$("#customPdfFeedback").html(`<span style="color: red">${e}</span>`)}}),$("#defaultCustomPdf").on("click",()=>{const e=defaultPDFTitleFn.toString();chrome.storage.local.set({pdfTitleFn:e}),_state.pdfTitleFn=defaultPDFTitleFn,$("#customPdfTitleTextarea").val(e),$("#customPdfFeedback").html('<span style="color: green">Saved!</span>'),setTimeout(()=>{$("#customPdfFeedback").html("")},1e3)})},main=e=>{$(document).on("keydown",handlePopupKeydown),chrome.storage.local.get(_menuStorageKeys,t=>{getAndTrackPopupMenuChecks(t,_menuCheckNames),setStandardPopupClicks(),setAndHandleCustomPDFFunction(t);const o=isPaper(e);console.log("is: ",o);const s=Object.values(o).some(e=>e);if(console.log("isKnownPage: ",s),s){$("#notArxiv").hide(),$("#notPdf").hide(),$("#isArxiv").show();const t=parseIdFromUrl(e);_state.currentId=t,chrome.storage.local.get("papers",async({papers:o})=>{if(await initState(o),!o.hasOwnProperty(t))return console.log("Unknown id "+t),void updatePopupPaperNoMemory();const s=_state.papers[t],n=s.id.replace(".","\\.");$("#popup-paper-title").text(s.title),$("#popup-authors").text(s.author),s.codeLink&&($("#popup-code-link").show(),$("#popup-code-link").text(s.codeLink)),$("#popup-memory-edit").append(getPopupEditFormHTML(s)),$("#popup-copy-icons").html(getPopupPaperIconsHTML(s,e)),$(`#popup-item-tags--${n}`).select2({..._select2Options,width:"87%"}),$("body").css("height","auto"),$(`#popup-form-note-textarea--${n}`).on("focus",()=>{var e=this;textareaFocusEnd(e)}),$(`#popup-save-edits--${n}`).on("click",()=>{const e=$(`#popup-form-note-textarea--${n}`).val(),o=$(`#popup-form-note--${n}`).find(".form-code-input").first().val(),s=$(`#checkFavorite--${n}`).prop("checked");updatePaperTags(t,`#popup-item-tags--${n}`),saveNote(t,e),saveCodeLink(t,o),saveFavoriteItem(t,s),$("#popup-feedback-copied").text("Saved tags, code & note!"),$("#popup-feedback-copied").fadeIn(),setTimeout(()=>{$("#popup-feedback-copied").fadeOut()},1e3)}),$(`#popup-memory-item-link--${n}`).on("click",()=>{chrome.tabs.update({url:`https://arxiv.org/abs/${s.id.replace("Arxiv-","")}`}),window.close()}),$("#popup-code-link").on("click",()=>{const e=$("#popup-code-link").text();e&&focusExistingOrCreateNewCodeTab(e)}),$(`#popup-memory-item-copy-link--${n}`).on("click",()=>{const e=_state.papers[t].pdfLink;copyAndConfirmMemoryItem(t,e,"Pdf link copied!",!0)}),$(`#popup-memory-item-md--${n}`).on("click",()=>{const e=_state.papers[t].md;copyAndConfirmMemoryItem(t,e,"MarkDown link copied!",!0)}),$(`#popup-memory-item-bibtex--${n}`).on("click",()=>{const e=formatBibtext(_state.papers[t].bibtext);copyAndConfirmMemoryItem(t,e,"Bibtex citation copied!",!0)}),$(`#popup-memory-item-download--${n}`).on("click",()=>{let e=statePdfTitle(s.title,s.id);console.log({pdfTitle:e}),chrome.downloads.download({url:s.pdfLink,filename:e.replaceAll(":","_")})})})}})};$(()=>{const e={active:!0,lastFocusedWindow:!0};chrome.tabs.query(e,async e=>{main(e[0].url)})});const getMemoryItemHTML=e=>{const t=new Date(e.addDate).toLocaleString().replace(",",""),o=new Date(e.lastOpenDate).toLocaleString().replace(",",""),s=e.id.split("_")[0].split(".")[0],n=e.note||"",a=e.id,r=new Set(e.tags),i=getTagsHTMLOptions(e),l=e.favorite?"favorite":"",p={edit:"\"Edit paper details&#13;&#10;(or press 'e' when this paper is focused,&#13;&#10; i.e. when you navigated to it with 'tab')\"",pdfLink:`"Open ${e.pdfLink}"`,copyPdfLink:'"Copy pdf link"',copyMd:'"Copy Markdown-formatted link"',copyBibtext:'"Copy Bibtex citation"',visits:'"Number of times you have loaded&#13;&#10;the paper\'s Page or PDF"'};let d=`\n    <small class="memory-item-faded">\n        <span class="memory-item-code-link">${e.codeLink||""}</span>\n    </small>\n    `,c='<div class="memory-note-div memory-item-faded"></div>';return e.note&&(c=`\n        <div class="memory-note-div memory-item-faded">\n            <span class="note-content-header">Note:</span>\n            <span class="note-content">${n}</span>\n        </div>\n        `),`\n    <div class="memory-item-container ${l}" tabindex="0" id="memory-item-container--${a}">\n\n        <h4 class="memory-item-title" title="Added ${t}&#13;&#10;Last open ${o}">\n                <span class="memory-item-favorite">\n                    <svg style="vertical-align: bottom; stroke-width: 1px;" class="${l}">\n                        <use xlink:href="../../icons/tabler-sprite-nostroke.svg#tabler-star" />\n                    </svg>\n                </span>\n                ${e.title}\n        </h4>\n        <div class="memory-item-tags-div">\n            <small class="tag-list">\n                ${Array.from(r).map(e=>`<span class="memory-tag">${e}</span>`).join("")}\n            </small>\n            <div class="edit-tags">\n                <div style="display:flex; align-items: center"; justify-content: space-between">\n                    <select class="memory-item-tags" multiple="multiple">\n                        ${i}\n                    </select>\n                </div>\n            </div>\n        </div>\n        <small class="authors">${e.author}</small>\n        \n        <div class="code-and-note">\n            ${d}\n            ${c}\n        </div>\n\n        <div class="memory-item-actions">\n\n            <div style="display: flex; align-items: center">\n                <div class="memory-item-edit memory-item-svg-div" title=${p.edit} >\n                    <svg >\n                        <use xlink:href="../../icons/tabler-sprite-nostroke.svg#tabler-writing" />\n                    </svg>\n                </div>\n                \n                <small class="memory-item-faded">\n                        ${s}\n                </small>\n                        \n            </div>\n\n            <div class="memory-item-link memory-item-svg-div"  title=${p.pdfLink} >\n                <svg >\n                   <use xlink:href="../../icons/tabler-sprite-nostroke.svg#tabler-external-link" />\n                </svg>\n            </div>\n                \n            <div class="memory-item-copy-link memory-item-svg-div" title=${p.copyPdfLink} >\n                <svg >\n                    <use xlink:href="../../icons/tabler-sprite-nostroke.svg#tabler-link" />\n                </svg>\n            </div>\n\n            <div class="memory-item-md memory-item-svg-div" title=${p.copyMd} >\n                <svg >\n                    <use xlink:href="../../icons/tabler-sprite-nostroke.svg#tabler-clipboard-list" />\n                </svg>\n            </div>\n\n            <div class="memory-item-bibtext memory-item-svg-div" title=${p.copyBibtext}>\n                <svg >\n                    <use xlink:href="../../icons/tabler-sprite-nostroke.svg#tabler-archive" />\n                </svg>\n            </div>\n\n            <span style="color: green; display: none" class="memory-item-feedback"></span>\n            \n            <div title=${p.visits} class="memory-item-faded">\n                Visits: ${e.count}\n            </div>\n\n        </div>\n\n        <div class="extended-item" style="display: none">\n            <div class="item-note">\n                <form class="form-note">\n                    <div class="textarea-wrapper">\n                        <span class="label">Code:</span>\n                        <input type="text" class="form-code-input" value="${e.codeLink||""}">\n                    </div>\n                    <div class="textarea-wrapper">\n                        <span class="label">Note:</span>\n                        <textarea rows="3" class="form-note-textarea">${n}</textarea>\n                    </div>\n                    <div class="form-note-buttons">\n                        <button type="submit">Save</button>\n                        <button class="cancel-note-form back-to-focus">Cancel</button>\n                    </div>\n                </form>\n            </div>\n        </div>\n\n        <div class="delete-memory-item"> - </div>\n    </div>\n    `},getPopupEditFormHTML=e=>{const t=e.id,o=getTagsHTMLOptions(e),s=e.note||"";return`\n    <div style="max-width: 100%; display: flex; justify-content: space-between; align-items: center; padding: 16px;">\n        <div style="width: 100%">\n            <div style="width: 100%; display: flex; justify-content: space-between; align-items: center;">\n                <span class="label">Tags:</span>\n                <select id="popup-item-tags--${t}"class="memory-item-tags" multiple="multiple">\n                    ${o}\n                </select>\n            </div>\n            <div \n                class="form-note" \n                id="popup-form-note--${t}" \n                style="width: 100%; display: flex; justify-content: space-between; align-items: center; margin-top: 8px; flex-direction: column;"\n            >\n                <div class="textarea-wrapper w-100 mr-0">\n                    <span class="label">Code:</span>\n                    <input type="text" class="form-code-input mt-0 noMemoryOnA" value="${e.codeLink||""}">\n                </div>\n                <div class="textarea-wrapper w-100 mr-0">\n                    <span class="label">Note:</span>\n                    <textarea \n                        rows="3" \n                        style="width:85%;" \n                        class="noMemoryOnA"\n                        id="popup-form-note-textarea--${t}"\n                    >${s}</textarea>\n                </div>\n            </div>\n            <div style="display: flex; justify-content: space-between; align-items: center">\n                <div style="display: flex; justify-content: flex-start; align-items: center">\n                    <label for="checkFavorite" style="font-family: monospace; margin-right: 16px;">Favorite: </label>\n                    <input checked="${e.favorite?"true":""}" class="switch" type="checkbox" id="checkFavorite--${t}" name="checkFavorite" value="checkFavorite">\n                </div>\n                <button class="back-to-focus" id="popup-save-edits--${t}">Save</button>\n            </div>\n        </div>\n        <div>\n            \n        </div>\n    </div>`},getPopupPaperIconsHTML=(e,t)=>{const o=e.id,s="arxiv"!==e.source||t.indexOf(".pdf")<0?"none":"inherit";return`\n    <div\n        class="memory-item-svg-div" \n        id="popup-memory-item-link--${o}"\n        title="Open Paper HTML Page"\n        style="display: ${s}"\n    >\n        <svg  style="height: 25px; width: 25px; pointer-events: none;" >\n            <use xlink:href="../../icons/tabler-sprite-nostroke.svg#tabler-external-link" />\n        </svg>\n    </div>\n    <div \n        class="memory-item-svg-div"\n        id="popup-memory-item-copy-link--${o}"\n        title="Copy pdf link" \n    >\n        <svg style="height: 25px; width: 25px; pointer-events: none;" >\n            <use xlink:href="../../icons/tabler-sprite-nostroke.svg#tabler-link" />\n        </svg>\n    </div>\n\n    <div \n        class="memory-item-svg-div"\n        id="popup-memory-item-md--${o}"\n        title="Copy Markdown-formatted link" \n    >\n        <svg style="height: 25px; width: 25px; pointer-events: none;" >\n            <use xlink:href="../../icons/tabler-sprite-nostroke.svg#tabler-clipboard-list" />\n        </svg>\n    </div>\n\n    <div \n        class="memory-item-svg-div"\n        id="popup-memory-item-bibtex--${o}"\n        title="Copy Bibtex citation" \n    >\n        <svg style="height: 25px; width: 25px; pointer-events: none;" >\n            <use xlink:href="../../icons/tabler-sprite-nostroke.svg#tabler-archive" />\n        </svg>\n    </div>\n\n    <div \n        class="memory-item-svg-div"\n        id="popup-memory-item-download--${o}"\n        title="Download pdf" \n    >\n        <svg style="height: 25px; width: 25px; pointer-events: none;" >\n            <use xlink:href="../../icons/tabler-sprite-nostroke.svg#tabler-download" />\n        </svg>\n    </div>`};